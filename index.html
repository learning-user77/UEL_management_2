<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BLUE LOCK - Football League Manager</title>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Anime.js for animations -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        }

        :root {
            /* Light mode colors */
            --primary-blue: #0a1c3a;
            --secondary-blue: #1e3a6f;
            --accent-blue: #2b4f8e;
            --light-blue: #e6f0ff;
            --white: #ffffff;
            --gray-bg: #f5f7fa;
            --text-dark: #1e293b;
            --text-light: #64748b;
            --ego-red: #dc2626;
            --ego-red-dark: #b91c1c;
            --success-green: #10b981;
            --warning-yellow: #f59e0b;
            --card-bg: #ffffff;
            --border-color: #e2e8f0;
            --input-bg: #ffffff;
            --shadow: 0 2px 10px rgba(0,0,0,0.05);
            --stat-bg: #f0f4f8;
            --stat-hover: #e4eaf2;
            --mvp-purple: #8b5cf6;
            --motm-gold: #f59e0b;
            
            /* Blue Lock special colors */
            --isagi-blue: #00a3ff;
            --kaiser-crimson: #dc143c;
            --rin-violet: #9400d3;
            --bachira-yellow: #ffd700;
            --hiyori-cyan: #00ffff;
            --aiku-green: #00ff7f;
            --gagamaru-silver: #c0c0c0;
            --aryu-purple: #9370db;
            --niko-orange: #ff8c00;
            --gold: #ffd700;
            --silver: #c0c0c0;
            --bronze: #cd7f32;
            
            /* Hype color */
            --hype-pink: #ff1493;
            
            /* Neon effects */
            --neon-blue: #00f3ff;
            --neon-purple: #b300ff;
            --neon-pink: #ff00aa;
            --neon-green: #00ff9d;
            --neon-red: #ff0055;
            --glow-intensity: 0 0 10px;
        }

        [data-theme="dark"] {
            --primary-blue: #1a2c4a;
            --secondary-blue: #2e4a7f;
            --accent-blue: #3b5f9e;
            --light-blue: #1e293b;
            --white: #1a1a1a;
            --gray-bg: #0f0f0f;
            --text-dark: #ffffff;
            --text-light: #a0a0a0;
            --ego-red: #ef4444;
            --ego-red-dark: #dc2626;
            --success-green: #10b981;
            --warning-yellow: #f59e0b;
            --card-bg: #2d2d2d;
            --border-color: #404040;
            --input-bg: #333333;
            --shadow: 0 2px 10px rgba(0,0,0,0.3);
            --stat-bg: #2d2d2d;
            --stat-hover: #3d3d3d;
            --mvp-purple: #8b5cf6;
            --motm-gold: #f59e0b;
            --isagi-blue: #00a3ff;
            --kaiser-crimson: #dc143c;
            --rin-violet: #9400d3;
            --bachira-yellow: #ffd700;
            --hiyori-cyan: #00ffff;
            --aiku-green: #00ff7f;
            --gagamaru-silver: #c0c0c0;
            --aryu-purple: #9370db;
            --niko-orange: #ff8c00;
            --gold: #ffd700;
            --silver: #c0c0c0;
            --bronze: #cd7f32;
            --hype-pink: #ff1493;
            --neon-blue: #00f3ff;
            --neon-purple: #b300ff;
            --neon-pink: #ff00aa;
            --neon-green: #00ff9d;
            --neon-red: #ff0055;
        }

        body {
            background-color: var(--gray-bg);
            min-height: 100vh;
            color: var(--text-dark);
            transition: background-color 0.3s, color 0.3s;
        }

        /* Loading Spinner */
        .loading-spinner {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            z-index: 3000;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid var(--border-color);
            border-top-color: var(--accent-blue);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 1rem;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Theme Toggle */
        .theme-toggle {
            position: fixed;
            top: 20px;
            right: 80px;
            z-index: 1001;
            background: var(--card-bg);
            border: 2px solid var(--accent-blue);
            border-radius: 30px;
            padding: 5px;
            display: flex;
            gap: 5px;
            box-shadow: var(--shadow);
        }

        .theme-toggle button {
            padding: 8px 16px;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            background: transparent;
            color: var(--text-dark);
        }

        .theme-toggle button.active {
            background: var(--accent-blue);
            color: white;
            box-shadow: var(--glow-intensity) var(--neon-blue);
        }

        /* Logout Button */
        .logout-btn {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1001;
            background: var(--ego-red);
            color: white;
            border: none;
            border-radius: 30px;
            padding: 8px 20px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: var(--glow-intensity) var(--neon-red);
            transition: all 0.3s;
        }

        .logout-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 0 20px var(--neon-red);
        }

        .logout-btn.hidden {
            display: none;
        }

        /* Login Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 2000;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(5px);
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--card-bg);
            padding: 2rem;
            border-radius: 12px;
            width: 90%;
            max-width: 400px;
            position: relative;
            border-top: 4px solid var(--ego-red);
            box-shadow: 0 0 30px var(--neon-red);
            animation: modalGlow 2s infinite;
        }

        @keyframes modalGlow {
            0%, 100% { box-shadow: 0 0 30px var(--neon-red); }
            50% { box-shadow: 0 0 50px var(--neon-red); }
        }

        .modal-header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .modal-header h2 {
            color: var(--text-dark);
            font-size: 1.8rem;
            text-shadow: 0 0 10px var(--neon-blue);
        }

        .modal-header p {
            color: var(--text-light);
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            color: var(--text-dark);
            font-weight: 500;
        }

        .form-group input, .form-group textarea, .form-group select {
            width: 100%;
            padding: 0.75rem;
            background: var(--input-bg);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            font-size: 1rem;
            color: var(--text-dark);
            transition: all 0.3s;
        }

        .form-group input:focus, .form-group textarea:focus, .form-group select:focus {
            outline: none;
            border-color: var(--accent-blue);
            box-shadow: 0 0 15px var(--neon-blue);
        }

        .btn {
            padding: 0.75rem 1.5rem;
            background: linear-gradient(135deg, var(--primary-blue), var(--accent-blue));
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 0 20px var(--neon-blue);
        }

        .btn-secondary {
            background: transparent;
            border: 2px solid var(--accent-blue);
            color: var(--accent-blue);
        }

        .btn-secondary:hover {
            background: var(--accent-blue);
            color: white;
            box-shadow: 0 0 20px var(--neon-blue);
        }

        .btn-danger {
            background: linear-gradient(135deg, var(--ego-red), var(--ego-red-dark));
            color: white;
        }

        .btn-danger:hover {
            box-shadow: 0 0 20px var(--neon-red);
        }

        .btn-success {
            background: linear-gradient(135deg, var(--success-green), #059669);
            color: white;
        }

        .btn-success:hover {
            box-shadow: 0 0 20px var(--neon-green);
        }

        .btn-edit {
            background: var(--accent-blue);
            color: white;
            padding: 0.25rem 0.75rem;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8rem;
            margin: 0 0.25rem;
            transition: all 0.3s;
        }

        .btn-edit:hover {
            box-shadow: 0 0 15px var(--neon-blue);
            transform: scale(1.05);
        }

        .btn-delete {
            background: var(--ego-red);
            color: white;
            padding: 0.25rem 0.75rem;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8rem;
            margin: 0 0.25rem;
            transition: all 0.3s;
        }

        .btn-delete:hover {
            box-shadow: 0 0 15px var(--neon-red);
            transform: scale(1.05);
        }

        .btn-small {
            padding: 0.25rem 0.75rem;
            font-size: 0.8rem;
        }

        .btn-mvp {
            background: var(--mvp-purple);
            color: white;
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 600;
            box-shadow: 0 0 10px var(--mvp-purple);
            transition: all 0.3s;
        }

        .btn-mvp:hover {
            transform: scale(1.05);
            box-shadow: 0 0 20px var(--mvp-purple);
        }

        .btn-motm {
            background: var(--motm-gold);
            color: white;
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 600;
            box-shadow: 0 0 10px var(--motm-gold);
            transition: all 0.3s;
        }

        .btn-motm:hover {
            transform: scale(1.05);
            box-shadow: 0 0 20px var(--motm-gold);
        }

        .btn-hype {
            background: var(--hype-pink);
            color: white;
            padding: 0.5rem 1.5rem;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 600;
            box-shadow: 0 0 15px var(--hype-pink);
            transition: all 0.3s;
            animation: hypePulse 2s infinite;
        }

        @keyframes hypePulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .btn-hype:hover {
            transform: scale(1.1);
            box-shadow: 0 0 30px var(--hype-pink);
        }

        .btn-hype:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
            animation: none;
        }

        .badge-mvp {
            background: var(--mvp-purple);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
            box-shadow: 0 0 8px var(--mvp-purple);
            animation: mvpGlow 2s infinite;
        }

        @keyframes mvpGlow {
            0%, 100% { box-shadow: 0 0 8px var(--mvp-purple); }
            50% { box-shadow: 0 0 15px var(--mvp-purple); }
        }

        .badge-motm {
            background: var(--motm-gold);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
            box-shadow: 0 0 8px var(--motm-gold);
            animation: motmGlow 2s infinite;
        }

        @keyframes motmGlow {
            0%, 100% { box-shadow: 0 0 8px var(--motm-gold); }
            50% { box-shadow: 0 0 15px var(--motm-gold); }
        }

        .error-message {
            color: var(--ego-red);
            font-size: 0.9rem;
            margin-top: 0.5rem;
            text-align: center;
        }

        /* App Layout */
        .app {
            display: flex;
            min-height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            width: 260px;
            background: linear-gradient(180deg, var(--primary-blue) 0%, var(--secondary-blue) 100%);
            color: var(--white);
            padding: 2rem 1rem;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            border-right: 3px solid var(--accent-blue);
            transition: width 0.3s;
            box-shadow: 5px 0 15px rgba(0,0,0,0.3);
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 2rem;
            padding: 0 0.5rem;
        }

        .logo-icon {
            font-size: 2rem;
            filter: drop-shadow(0 0 10px var(--neon-blue));
            animation: logoFloat 3s infinite;
        }

        @keyframes logoFloat {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }

        .logo-text {
            font-size: 1.5rem;
            font-weight: 800;
            letter-spacing: 1px;
            background: linear-gradient(135deg, #fff 0%, var(--neon-blue) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 0 20px var(--neon-blue);
        }

        .logo-text span {
            font-size: 0.8rem;
            display: block;
            font-weight: 400;
            letter-spacing: 2px;
            color: #90caf9;
            -webkit-text-fill-color: #90caf9;
        }

        .nav-menu {
            list-style: none;
            margin-top: 1rem;
        }

        .nav-item {
            margin-bottom: 0.25rem;
        }

        .nav-link {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 0.75rem 1rem;
            color: var(--light-blue);
            text-decoration: none;
            border-radius: 8px;
            transition: all 0.3s;
            font-weight: 500;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .nav-link::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
            transition: left 0.5s;
        }

        .nav-link:hover::before {
            left: 100%;
        }

        .nav-link:hover, .nav-link.active {
            background: rgba(255, 255, 255, 0.1);
            color: var(--white);
            box-shadow: 0 0 15px var(--neon-blue);
            transform: translateX(5px);
        }

        .nav-link.active {
            border-left: 4px solid var(--white);
            background: linear-gradient(90deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.05) 100%);
        }

        .nav-link i {
            font-size: 1.2rem;
            width: 24px;
            text-align: center;
        }

        .admin-badge {
            background: var(--ego-red);
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.7rem;
            margin-left: auto;
            box-shadow: 0 0 10px var(--neon-red);
        }

        /* Submenu */
        .submenu {
            list-style: none;
            margin-left: 2.5rem;
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
        }

        .submenu.active {
            max-height: 300px;
        }

        .submenu-item {
            margin: 0.5rem 0;
        }

        .submenu-link {
            color: var(--light-blue);
            text-decoration: none;
            font-size: 0.9rem;
            padding: 0.5rem 1rem;
            display: block;
            border-radius: 6px;
            transition: all 0.3s;
            cursor: pointer;
        }

        .submenu-link:hover {
            background: rgba(255, 255, 255, 0.1);
            color: var(--white);
            box-shadow: 0 0 10px var(--neon-blue);
        }

        /* Main Content */
        .main-content {
            flex: 1;
            margin-left: 260px;
            padding: 2rem;
        }

        /* Header */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            background: var(--card-bg);
            padding: 1rem 2rem;
            border-radius: 12px;
            box-shadow: var(--shadow);
            cursor: pointer;
            border: 1px solid var(--border-color);
            transition: all 0.3s;
        }

        .header:hover {
            box-shadow: 0 0 20px var(--neon-blue);
            transform: translateY(-2px);
        }

        .page-title h1 {
            color: var(--text-dark);
            font-size: 1.8rem;
            text-shadow: 0 0 10px var(--neon-blue);
        }

        .user-profile {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .user-info {
            text-align: right;
        }

        .user-name {
            font-weight: 600;
            color: var(--text-dark);
        }

        .user-role {
            font-size: 0.8rem;
            color: var(--text-light);
        }

        .user-avatar {
            width: 45px;
            height: 45px;
            background: linear-gradient(135deg, var(--primary-blue), var(--accent-blue));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 0 15px var(--neon-blue);
            transition: all 0.3s;
        }

        .user-avatar:hover {
            transform: scale(1.1);
            box-shadow: 0 0 25px var(--neon-blue);
        }

        /* Content Area */
        .content-area {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 2rem;
            box-shadow: var(--shadow);
            min-height: 500px;
            border: 1px solid var(--border-color);
            transition: all 0.3s;
        }

        .content-area:hover {
            box-shadow: 0 0 20px var(--neon-blue);
        }

        /* Compact Number Format */
        .compact-number {
            font-feature-settings: "tnum";
        }

        /* Registry Tab Styles */
        .registration-section {
            background: var(--gray-bg);
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            border: 1px solid var(--border-color);
            transition: all 0.3s;
        }

        .registration-section:hover {
            box-shadow: 0 0 15px var(--neon-blue);
        }

        .registration-section h2 {
            color: var(--text-dark);
            font-size: 1.4rem;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 10px;
            text-shadow: 0 0 10px var(--neon-blue);
        }

        .registration-section h2 i {
            color: var(--accent-blue);
        }

        .registration-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
        }

        .registration-card {
            background: var(--card-bg);
            padding: 1.5rem;
            border-radius: 8px;
            border: 1px solid var(--border-color);
            transition: all 0.3s;
        }

        .registration-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 0 15px var(--neon-blue);
        }

        .color-input-group {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .color-input-group input[type="color"] {
            width: 60px;
            height: 40px;
            padding: 0;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            cursor: pointer;
        }

        .teams-list {
            margin-top: 2rem;
        }

        .team-card {
            background: var(--gray-bg);
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            border-left: 4px solid;
            transition: all 0.3s;
        }

        .team-card:hover {
            transform: translateX(5px);
            box-shadow: 0 0 15px var(--neon-blue);
        }

        .team-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid var(--border-color);
        }

        .team-title {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .team-color {
            width: 24px;
            height: 24px;
            border-radius: 4px;
            box-shadow: 0 0 10px currentColor;
        }

        .team-name {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--text-dark);
        }

        .team-controls {
            display: flex;
            gap: 0.5rem;
        }

        .player-row {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr 1fr 1fr 1fr auto auto;
            gap: 0.5rem;
            padding: 0.5rem;
            align-items: center;
            border-bottom: 1px solid var(--border-color);
            cursor: pointer;
            transition: all 0.2s;
        }

        .player-row:hover {
            background: var(--stat-hover);
            transform: scale(1.01);
            box-shadow: 0 0 10px var(--neon-blue);
        }

        .player-row.header {
            font-weight: 600;
            color: var(--text-light);
            font-size: 0.9rem;
            border-bottom: 2px solid var(--border-color);
            cursor: default;
        }

        .player-row.header:hover {
            background: transparent;
            transform: none;
            box-shadow: none;
        }

        .player-name {
            font-weight: 500;
            color: var(--text-dark);
        }

        .stat-display {
            background: var(--stat-bg);
            padding: 0.5rem;
            border-radius: 4px;
            text-align: center;
            font-weight: 500;
            color: var(--text-dark);
            border: 1px solid var(--border-color);
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.1);
            cursor: default;
        }

        .value-display {
            background: linear-gradient(135deg, var(--success-green), #059669);
            color: white;
            padding: 0.5rem;
            border-radius: 4px;
            text-align: center;
            font-weight: 600;
            font-size: 0.9rem;
            box-shadow: 0 0 10px var(--neon-green);
        }

        .player-actions {
            display: flex;
            gap: 0.25rem;
        }

        .bulk-add-section {
            margin-top: 1rem;
            padding: 1rem;
            background: var(--card-bg);
            border-radius: 8px;
            border: 1px dashed var(--accent-blue);
        }

        .bulk-add-section textarea {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            background: var(--input-bg);
            color: var(--text-dark);
            margin-bottom: 1rem;
        }

        /* Fixtures Tab Styles */
        .matchday-section {
            background: var(--gray-bg);
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            border: 1px solid var(--border-color);
            transition: all 0.3s;
        }

        .matchday-section:hover {
            box-shadow: 0 0 15px var(--neon-blue);
        }

        .matchday-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            cursor: pointer;
        }

        .matchday-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: var(--text-dark);
            display: flex;
            align-items: center;
            gap: 1rem;
            text-shadow: 0 0 10px var(--neon-blue);
        }

        .matchday-controls {
            display: flex;
            gap: 0.5rem;
        }

        .match-card {
            background: var(--card-bg);
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
            border: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s;
        }

        .match-card:hover {
            transform: translateX(5px);
            box-shadow: 0 0 15px var(--neon-blue);
        }

        .match-info {
            display: flex;
            align-items: center;
            gap: 2rem;
            flex: 1;
        }

        .match-teams {
            display: flex;
            align-items: center;
            gap: 1rem;
            font-weight: 600;
        }

        .match-status {
            padding: 0.25rem 1rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .status-scheduled {
            background: var(--warning-yellow);
            color: white;
            box-shadow: 0 0 10px var(--warning-yellow);
        }

        .status-completed {
            background: var(--success-green);
            color: white;
            box-shadow: 0 0 10px var(--neon-green);
        }

        .match-actions {
            display: flex;
            gap: 0.5rem;
        }

        /* Result Entry Styles */
        .result-entry {
            background: var(--gray-bg);
            border-radius: 8px;
            padding: 2rem;
        }

        .teams-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .team-stats {
            background: var(--card-bg);
            border-radius: 8px;
            padding: 1.5rem;
            border: 1px solid var(--border-color);
        }

        .team-stats h3 {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1.5rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid var(--border-color);
            text-shadow: 0 0 10px currentColor;
        }

        .player-stat-row {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr 1fr 1fr;
            gap: 0.5rem;
            padding: 0.5rem;
            align-items: center;
            border-bottom: 1px solid var(--border-color);
        }

        .player-stat-row.header {
            font-weight: 600;
            color: var(--text-light);
            font-size: 0.9rem;
            background: var(--stat-bg);
        }

        .player-stat-row .player-name {
            cursor: pointer;
            transition: all 0.2s;
        }

        .player-stat-row .player-name:hover {
            text-decoration: underline;
            text-shadow: 0 0 10px currentColor;
        }

        .leg-select {
            padding: 0.25rem;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            background: var(--input-bg);
            color: var(--text-dark);
        }

        .stat-input {
            width: 60px;
            padding: 0.25rem;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            background: var(--input-bg);
            color: var(--text-dark);
            text-align: center;
        }

        .stat-input:disabled {
            background: var(--stat-bg);
            color: var(--text-light);
            cursor: not-allowed;
            opacity: 0.7;
        }

        .fouls-section {
            background: var(--card-bg);
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            display: flex;
            align-items: center;
            gap: 2rem;
            border: 1px solid var(--border-color);
        }

        .fouls-input {
            width: 100px;
            padding: 0.5rem;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            background: var(--input-bg);
            color: var(--text-dark);
            text-align: center;
        }

        .mvp-motm-section {
            background: var(--card-bg);
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            border: 1px solid var(--border-color);
        }

        .selection-group {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .selection-group select {
            padding: 0.75rem;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            background: var(--input-bg);
            color: var(--text-dark);
        }

        /* Results Tab Styles */
        .result-card {
            background: var(--gray-bg);
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            border-left: 4px solid var(--accent-blue);
            transition: all 0.3s;
        }

        .result-card:hover {
            transform: translateX(5px);
            box-shadow: 0 0 15px var(--neon-blue);
        }

        .result-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid var(--border-color);
        }

        .result-score {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-dark);
        }

        .result-badges {
            display: flex;
            gap: 1rem;
        }

        .expand-btn {
            background: transparent;
            border: 1px solid var(--accent-blue);
            color: var(--accent-blue);
            padding: 0.25rem 0.75rem;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: all 0.3s;
        }

        .expand-btn:hover {
            background: var(--accent-blue);
            color: white;
            box-shadow: 0 0 10px var(--neon-blue);
        }

        .result-details {
            display: none;
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid var(--border-color);
        }

        .result-details.active {
            display: block;
        }

        .player-stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .team-result-stats {
            background: var(--card-bg);
            border-radius: 8px;
            padding: 1rem;
            border: 1px solid var(--border-color);
        }

        .team-result-stats h4 {
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid var(--border-color);
            text-shadow: 0 0 10px currentColor;
        }

        .result-player-name {
            cursor: pointer;
            transition: all 0.2s;
        }

        .result-player-name:hover {
            text-decoration: underline;
            text-shadow: 0 0 10px var(--accent-blue);
        }

        /* Team LB Styles */
        .leaderboard-container {
            overflow-x: auto;
        }

        .leaderboard-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 2rem;
            table-layout: fixed; /* Force fixed layout for perfect alignment */
        }

        .leaderboard-table th {
            background: var(--primary-blue);
            color: white;
            padding: 1rem;
            font-weight: 600;
            text-shadow: 0 0 10px var(--neon-blue);
        }

        .leaderboard-table td {
            padding: 1rem;
            border-bottom: 1px solid var(--border-color);
        }

        /* Define column widths (adjust percentages as needed) */
        .leaderboard-table th:nth-child(1),
        .leaderboard-table td:nth-child(1) { width: 5%; }   /* Rank */
        .leaderboard-table th:nth-child(2),
        .leaderboard-table td:nth-child(2) { width: 20%; }  /* Team */
        .leaderboard-table th:nth-child(3),
        .leaderboard-table td:nth-child(3) { width: 5%; }   /* MP */
        .leaderboard-table th:nth-child(4),
        .leaderboard-table td:nth-child(4) { width: 5%; }   /* W */
        .leaderboard-table th:nth-child(5),
        .leaderboard-table td:nth-child(5) { width: 5%; }   /* D */
        .leaderboard-table th:nth-child(6),
        .leaderboard-table td:nth-child(6) { width: 5%; }   /* L */
        .leaderboard-table th:nth-child(7),
        .leaderboard-table td:nth-child(7) { width: 7%; }   /* GF */
        .leaderboard-table th:nth-child(8),
        .leaderboard-table td:nth-child(8) { width: 7%; }   /* GA */
        .leaderboard-table th:nth-child(9),
        .leaderboard-table td:nth-child(9) { width: 7%; }   /* GD */
        .leaderboard-table th:nth-child(10),
        .leaderboard-table td:nth-child(10) { width: 7%; }  /* Pts */
        .leaderboard-table th:nth-child(11),
        .leaderboard-table td:nth-child(11) { width: 10%; } /* Streak */

        /* Alignment: center all by default, left-align rank and team */
        .leaderboard-table th, 
        .leaderboard-table td {
            text-align: center;
            vertical-align: middle;
        }
        .leaderboard-table th:nth-child(1),
        .leaderboard-table td:nth-child(1),
        .leaderboard-table th:nth-child(2),
        .leaderboard-table td:nth-child(2) {
            text-align: left;
        }

        /* Force perfect alignment in the Rank column */
        .leaderboard-table td:first-child {
            display: flex;
            align-items: center;
            justify-content: flex-start;
            gap: 8px;
            height: 100%;
        }

        /* Ensure header aligns with data cells */
        .leaderboard-table th:first-child {
            text-align: left;
            padding-left: 8px;
        }

        .leaderboard-table tr {
            transition: background 0.3s;
        }

        .leaderboard-table tr:hover {
            background: var(--stat-hover);
            box-shadow: 0 0 15px var(--neon-blue);
        }

        .stat-green {
            color: var(--success-green);
            font-weight: 600;
            text-shadow: 0 0 10px var(--neon-green);
        }

        .stat-red {
            color: var(--ego-red);
            font-weight: 600;
            text-shadow: 0 0 10px var(--neon-red);
        }

        .stat-grey {
            color: var(--text-light);
        }

        .stat-purple {
            color: var(--mvp-purple);
            font-weight: 700;
            text-shadow: 0 0 10px var(--mvp-purple);
        }

        /* Top 3 Animations */
        .rank-1 {
            background: linear-gradient(45deg, var(--isagi-blue), var(--kaiser-crimson));
            animation: rank1Glow 2s ease-in-out infinite;
            position: relative;
            overflow: hidden;
            color: white !important;
            font-weight: 700;
        }

        .rank-1 td {
            color: white !important;
        }

        .rank-1::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255,255,255,0.3), transparent);
            transform: rotate(45deg);
            animation: rank1Shine 3s infinite;
        }

        .rank-2 {
            background: linear-gradient(45deg, var(--rin-violet), var(--bachira-yellow));
            animation: rank2Pulse 2s ease-in-out infinite;
            color: white !important;
            font-weight: 700;
        }

        .rank-2 td {
            color: white !important;
        }

        .rank-3 {
            background: linear-gradient(45deg, var(--hiyori-cyan), var(--aiku-green));
            animation: rank3Breath 2s ease-in-out infinite;
            color: white !important;
            font-weight: 700;
        }

        .rank-3 td {
            color: white !important;
        }

        @keyframes rank1Glow {
            0%, 100% { box-shadow: 0 0 20px var(--isagi-blue); }
            50% { box-shadow: 0 0 40px var(--kaiser-crimson); }
        }

        @keyframes rank1Shine {
            0% { transform: rotate(45deg) translateX(-100%); }
            100% { transform: rotate(45deg) translateX(100%); }
        }

        @keyframes rank2Pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.02); }
        }

        @keyframes rank3Breath {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.9; }
        }

        /* Stats Cards */
        .stats-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: var(--card-bg);
            padding: 1.5rem;
            border-radius: 12px;
            box-shadow: var(--shadow);
            border-left: 4px solid;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255,255,255,0.1), transparent);
            transform: rotate(45deg);
            transition: transform 0.5s;
        }

        .stat-card:hover::before {
            transform: rotate(45deg) translate(50%, 50%);
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 0 30px currentColor;
        }

        .stat-card.rulers {
            border-left-color: var(--isagi-blue);
            background: linear-gradient(135deg, var(--card-bg), rgba(0, 163, 255, 0.1));
        }

        .stat-card.offensive {
            border-left-color: var(--kaiser-crimson);
            background: linear-gradient(135deg, var(--card-bg), rgba(220, 20, 60, 0.1));
        }

        .stat-card.defensive {
            border-left-color: var(--gagamaru-silver);
            background: linear-gradient(135deg, var(--card-bg), rgba(192, 192, 192, 0.1));
        }

        .stat-card h3 {
            font-size: 1.1rem;
            margin-bottom: 0.5rem;
            color: var(--text-light);
        }

        .stat-card .value {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 0.25rem;
            text-shadow: 0 0 15px currentColor;
        }

        .stat-card .team {
            font-size: 1rem;
            color: var(--text-light);
        }

        /* Player LB Styles */
        .player-rank-1 {
            background: linear-gradient(45deg, var(--isagi-blue), var(--kaiser-crimson));
            color: white !important;
            animation: rank1Glow 2s ease-in-out infinite;
            font-weight: 700;
        }

        .player-rank-1 td {
            color: white !important;
        }

        .player-rank-2 {
            background: linear-gradient(45deg, var(--rin-violet), var(--bachira-yellow));
            color: white !important;
            animation: rank2Pulse 2s ease-in-out infinite;
            font-weight: 700;
        }

        .player-rank-2 td {
            color: white !important;
        }

        .player-rank-3 {
            background: linear-gradient(45deg, var(--hiyori-cyan), var(--aiku-green));
            color: white !important;
            animation: rank3Breath 2s ease-in-out infinite;
            font-weight: 700;
        }

        .player-rank-3 td {
            color: white !important;
        }

        .award-gold {
            background: linear-gradient(135deg, var(--gold), #ffed4e);
            color: #000 !important;
            font-weight: 700;
            animation: goldGlow 2s ease-in-out infinite;
        }

        .award-silver {
            background: linear-gradient(135deg, var(--silver), #e0e0e0);
            color: #000 !important;
            font-weight: 700;
            animation: silverGlow 2s ease-in-out infinite;
        }

        .award-bronze {
            background: linear-gradient(135deg, var(--bronze), #cd7f32);
            color: #fff !important;
            font-weight: 700;
            animation: bronzeGlow 2s ease-in-out infinite;
        }

        @keyframes goldGlow {
            0%, 100% { box-shadow: 0 0 10px var(--gold); }
            50% { box-shadow: 0 0 20px var(--gold); }
        }

        @keyframes silverGlow {
            0%, 100% { box-shadow: 0 0 10px var(--silver); }
            50% { box-shadow: 0 0 20px var(--silver); }
        }

        @keyframes bronzeGlow {
            0%, 100% { box-shadow: 0 0 10px var(--bronze); }
            50% { box-shadow: 0 0 20px var(--bronze); }
        }

        /* Player Profile Modal */
        .player-profile {
            max-width: 800px !important;
            max-height: 90vh;
            overflow-y: auto;
        }

        .profile-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid var(--border-color);
        }

        .profile-title h2 {
            font-size: 2rem;
            margin-bottom: 0.25rem;
            text-shadow: 0 0 15px var(--neon-blue);
        }

        .profile-title .team-name {
            font-size: 1.1rem;
            color: var(--text-light);
            text-shadow: 0 0 10px currentColor;
        }

        .profile-value {
            text-align: right;
        }

        .profile-value .label {
            font-size: 0.9rem;
            color: var(--text-light);
        }

        .profile-value .amount {
            font-size: 2rem;
            font-weight: 700;
            color: var(--success-green);
            text-shadow: 0 0 15px var(--neon-green);
        }

        .profile-stats {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .profile-stat {
            background: var(--stat-bg);
            padding: 1rem;
            border-radius: 8px;
            text-align: center;
            border: 1px solid var(--border-color);
            transition: all 0.3s;
        }

        .profile-stat:hover {
            transform: translateY(-5px);
            box-shadow: 0 0 15px var(--neon-blue);
        }

        .profile-stat .value {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--text-dark);
            text-shadow: 0 0 10px currentColor;
        }

        .profile-stat .label {
            font-size: 0.9rem;
            color: var(--text-light);
            margin-top: 0.25rem;
        }

        .profile-actions {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .leg-analysis {
            background: var(--stat-bg);
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            border: 1px solid var(--border-color);
        }

        .leg-analysis h3 {
            margin-bottom: 1rem;
            color: var(--text-dark);
            text-shadow: 0 0 10px var(--neon-blue);
        }

        .leg-stats {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1rem;
        }

        .leg-stat {
            text-align: center;
        }

        .leg-stat .value {
            font-size: 1.5rem;
            font-weight: 700;
        }

        .leg-stat .label {
            font-size: 0.8rem;
            color: var(--text-light);
        }

        .match-history {
            margin-bottom: 2rem;
        }

        .match-history h3 {
            margin-bottom: 1rem;
            color: var(--text-dark);
            text-shadow: 0 0 10px var(--neon-blue);
        }

        .history-card {
            background: var(--card-bg);
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
            border: 1px solid var(--border-color);
            transition: all 0.3s;
        }

        .history-card:hover {
            transform: translateX(5px);
            box-shadow: 0 0 15px var(--neon-blue);
        }

        .history-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
        }

        .history-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .history-badge.mvp {
            background: var(--mvp-purple);
            color: white;
            box-shadow: 0 0 10px var(--mvp-purple);
        }

        .history-badge.motm {
            background: var(--motm-gold);
            color: white;
            box-shadow: 0 0 10px var(--motm-gold);
        }

        .history-teams {
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .history-stats {
            display: flex;
            gap: 1rem;
            color: var(--text-light);
            font-size: 0.9rem;
        }

        .transfer-record {
            margin-bottom: 1rem;
        }

        .transfer-record h3 {
            margin-bottom: 1rem;
            color: var(--text-dark);
            text-shadow: 0 0 10px var(--neon-blue);
        }

        .transfer-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem;
            background: var(--card-bg);
            border-radius: 8px;
            margin-bottom: 0.5rem;
            border: 1px solid var(--border-color);
            transition: all 0.3s;
        }

        .transfer-item:hover {
            transform: translateX(5px);
            box-shadow: 0 0 15px var(--neon-blue);
        }

        .transfer-teams {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .transfer-arrow {
            color: var(--text-light);
        }

        .transfer-date {
            color: var(--text-light);
            font-size: 0.9rem;
        }

        /* Compare Modal */
        .compare-modal {
            max-width: 600px !important;
        }

        .compare-select {
            margin-bottom: 1.5rem;
        }

        .compare-stats {
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            gap: 1rem;
            align-items: center;
        }

        .compare-player {
            background: var(--stat-bg);
            padding: 1rem;
            border-radius: 8px;
            border: 1px solid var(--border-color);
        }

        .compare-player h4 {
            margin-bottom: 1rem;
            text-align: center;
            text-shadow: 0 0 10px currentColor;
        }

        .compare-stat-row {
            display: flex;
            justify-content: space-between;
            padding: 0.5rem 0;
            border-bottom: 1px solid var(--border-color);
        }

        .compare-stat-row.win {
            color: var(--success-green);
            font-weight: 600;
            text-shadow: 0 0 10px var(--neon-green);
        }

        .compare-stat-row.lose {
            color: var(--ego-red);
            text-shadow: 0 0 10px var(--neon-red);
        }

        .compare-vs {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--accent-blue);
            text-shadow: 0 0 15px var(--neon-blue);
            animation: vsPulse 2s infinite;
        }

        @keyframes vsPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .hype-count {
            display: inline-block;
            margin-left: 0.5rem;
            padding: 0.25rem 0.5rem;
            background: var(--hype-pink);
            color: white;
            border-radius: 12px;
            font-size: 0.8rem;
            box-shadow: 0 0 10px var(--hype-pink);
        }

        /* Logs Tab Styles */
        .logs-container {
            max-height: 600px;
            overflow-y: auto;
        }

        .log-entry {
            display: flex;
            justify-content: space-between;
            padding: 1rem;
            border-bottom: 1px solid var(--border-color);
            font-size: 0.9rem;
            transition: all 0.3s;
        }

        .log-entry:hover {
            background: var(--stat-bg);
            transform: translateX(5px);
            box-shadow: 0 0 10px var(--neon-blue);
        }

        .log-admin {
            font-weight: 600;
            color: var(--accent-blue);
        }

        .log-action {
            color: var(--text-dark);
        }

        .log-time {
            color: var(--text-light);
            font-size: 0.8rem;
        }

        /* Guide Sections */
        .guide-sections {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .guide-section {
            background: var(--gray-bg);
            border-radius: 8px;
            padding: 1.5rem;
            border-left: 4px solid var(--accent-blue);
            transition: all 0.3s;
        }

        .guide-section:hover {
            transform: translateX(5px);
            box-shadow: 0 0 15px var(--neon-blue);
        }

        .guide-section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .guide-section-title {
            font-size: 1.3rem;
            color: var(--text-dark);
            font-weight: 600;
            text-shadow: 0 0 10px var(--neon-blue);
        }

        .guide-section-content {
            color: var(--text-light);
            line-height: 1.6;
            white-space: pre-wrap;
        }

        .guide-section-meta {
            margin-top: 1rem;
            font-size: 0.8rem;
            color: var(--text-light);
            border-top: 1px solid var(--border-color);
            padding-top: 1rem;
        }

        /* Add Section Form */
        .add-section-form {
            background: var(--gray-bg);
            padding: 1.5rem;
            border-radius: 8px;
            margin-bottom: 2rem;
            display: none;
        }

        .add-section-form.active {
            display: block;
        }

        .form-row {
            margin-bottom: 1rem;
        }

        .form-row label {
            display: block;
            margin-bottom: 0.5rem;
            color: var(--text-dark);
            font-weight: 500;
        }

        /* Others Tab Styles */
        .settings-section {
            background: var(--gray-bg);
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            border: 1px solid var(--border-color);
            transition: all 0.3s;
        }

        .settings-section:hover {
            box-shadow: 0 0 15px var(--neon-blue);
        }

        .settings-section h2 {
            color: var(--text-dark);
            font-size: 1.4rem;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 10px;
            text-shadow: 0 0 10px var(--neon-blue);
        }

        .settings-section h2 i {
            color: var(--accent-blue);
        }

        .settings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .setting-card {
            background: var(--card-bg);
            padding: 1.5rem;
            border-radius: 8px;
            border: 1px solid var(--border-color);
            transition: all 0.3s;
        }

        .setting-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 0 15px var(--neon-blue);
        }

        .setting-card h3 {
            color: var(--text-dark);
            font-size: 1.1rem;
            margin-bottom: 1rem;
        }

        .value-input-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .value-input-group label {
            color: var(--text-light);
            font-size: 0.9rem;
        }

        .value-input-group input {
            padding: 0.75rem;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            background: var(--input-bg);
            color: var(--text-dark);
            font-size: 1rem;
        }

        .value-input-group input:focus {
            outline: none;
            border-color: var(--accent-blue);
            box-shadow: 0 0 15px var(--neon-blue);
        }

        .value-range {
            display: flex;
            justify-content: space-between;
            color: var(--text-light);
            font-size: 0.8rem;
            margin-top: 0.25rem;
        }

        .current-value {
            background: var(--accent-blue);
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.9rem;
            margin-left: 0.5rem;
            box-shadow: 0 0 10px var(--neon-blue);
        }

        .danger-zone {
            background: rgba(220, 38, 38, 0.1);
            border: 1px solid var(--ego-red);
        }

        .danger-zone h2 i {
            color: var(--ego-red);
        }

        .reset-confirmation {
            margin-top: 1rem;
            padding: 1rem;
            background: var(--card-bg);
            border-radius: 6px;
            display: none;
            border: 1px solid var(--ego-red);
        }

        .reset-confirmation.active {
            display: block;
        }

        .reset-confirmation p {
            color: var(--ego-red);
            font-weight: 600;
            margin-bottom: 1rem;
            text-shadow: 0 0 10px var(--neon-red);
        }

        .warning-text {
            color: var(--warning-yellow);
            font-weight: 500;
            margin: 1rem 0;
            text-shadow: 0 0 10px var(--warning-yellow);
        }

        .success-message {
            background: var(--success-green);
            color: white;
            padding: 1rem;
            border-radius: 6px;
            margin-bottom: 1rem;
            display: none;
            box-shadow: 0 0 20px var(--neon-green);
        }

        .success-message.active {
            display: block;
        }

        /* Ego Quote */
        .ego-quote {
            margin-top: 2rem;
            padding: 1rem;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
            border-left: 3px solid var(--ego-red);
            font-style: italic;
            font-size: 0.9rem;
            color: #bbd7fb;
            box-shadow: 0 0 15px var(--neon-red);
        }

        /* Visitor Message */
        .visitor-message {
            text-align: center;
            padding: 2rem;
            background: var(--light-blue);
            border-radius: 8px;
            color: var(--text-dark);
            margin-bottom: 2rem;
            border: 1px solid var(--border-color);
        }

        .visitor-message i {
            font-size: 3rem;
            color: var(--accent-blue);
            margin-bottom: 1rem;
            animation: iconFloat 3s infinite;
        }

        @keyframes iconFloat {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .sidebar {
                width: 80px;
            }
            
            .logo-text, .nav-link span, .ego-quote, .submenu, .admin-badge {
                display: none;
            }
            
            .main-content {
                margin-left: 80px;
            }
            
            .nav-link {
                justify-content: center;
            }
            
            .registration-grid {
                grid-template-columns: 1fr;
            }
            
            .player-row {
                grid-template-columns: 1fr;
                gap: 0.5rem;
            }
            
            .player-row.header {
                display: none;
            }
            
            .teams-container {
                grid-template-columns: 1fr;
            }
            
            .mvp-motm-section {
                grid-template-columns: 1fr;
            }
            
            .stats-cards {
                grid-template-columns: 1fr;
            }
            
            .profile-stats {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .leg-stats {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .compare-stats {
                grid-template-columns: 1fr;
            }
            
            .compare-vs {
                text-align: center;
                margin: 1rem 0;
            }
            
            .theme-toggle {
                right: 100px;
            }
        }
    </style>
</head>
<body data-theme="light">
    <!-- Loading Spinner -->
    <div class="loading-spinner" id="loadingSpinner">
        <div class="spinner"></div>
        <p>Loading Blue Lock Manager...</p>
    </div>

    <!-- Theme Toggle -->
    <div class="theme-toggle">
        <button class="active" onclick="setTheme('light', this)"><i class="fas fa-sun"></i> Light</button>
        <button onclick="setTheme('dark', this)"><i class="fas fa-moon"></i> Dark</button>
    </div>

    <!-- Logout Button -->
    <button class="logout-btn hidden" id="logoutBtn" onclick="logout()">
        <i class="fas fa-sign-out-alt"></i> Logout
    </button>

    <!-- Login Modal -->
    <div class="modal" id="loginModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2> BLUE LOCK</h2>
                <p>Admin Login</p>
            </div>
            
            <div class="form-group">
                <label>Email</label>
                <input type="email" id="email" placeholder="admin@bluelock.com">
            </div>
            
            <div class="form-group">
                <label>Password</label>
                <input type="password" id="password" placeholder="">
            </div>
            
            <button class="btn" onclick="login()">Login as Admin</button>
            
            <div id="errorMessage" class="error-message"></div>
        </div>
    </div>

    <!-- Main App -->
    <div class="app" id="app">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="logo">
                <span class="logo-icon"></span>
                <div class="logo-text">
                    BLUE LOCK
                    <span>MANAGER</span>
                </div>
            </div>
            
            <ul class="nav-menu">
                <li class="nav-item">
                    <a class="nav-link" onclick="showContent('guide', event)">
                        <i></i>
                        <span>1. Guide</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" onclick="showContent('registry', event)">
                        <i></i>
                        <span>2. Registry</span>
                        <span class="admin-badge" id="registryBadge" style="display: none;">Admin</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" onclick="showContent('fixtures', event)">
                        <i></i>
                        <span>3. Fixtures</span>
                        <span class="admin-badge" id="fixturesBadge" style="display: none;">Admin</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" onclick="showContent('results', event)">
                        <i></i>
                        <span>4. Results</span>
                        <span class="admin-badge" id="resultsBadge" style="display: none;">Admin</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" onclick="showContent('team-lb', event)">
                        <i></i>
                        <span>5. Team LB</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" onclick="toggleSubmenu(event)">
                        <i></i>
                        <span>6. Player LB</span>
                        <span style="margin-left: auto;"></span>
                    </a>
                    <ul class="submenu" id="playerLBSubmenu">
                        <li class="submenu-item">
                            <a class="submenu-link" onclick="showContent('most-goals', event)">6.1 Most Goals</a>
                        </li>
                        <li class="submenu-item">
                            <a class="submenu-link" onclick="showContent('most-assists', event)">6.2 Most Assists</a>
                        </li>
                        <li class="submenu-item">
                            <a class="submenu-link" onclick="showContent('most-saves', event)">6.3 Most Saves</a>
                        </li>
                        <li class="submenu-item">
                            <a class="submenu-link" onclick="showContent('most-awards', event)">6.4 Most Awards</a>
                        </li>
                        <li class="submenu-item">
                            <a class="submenu-link" onclick="showContent('most-valued', event)">6.5 Most Valued</a>
                        </li>
                    </ul>
                </li>
                <li class="nav-item">
                    <a class="nav-link" onclick="showContent('logs', event)">
                        <i></i>
                        <span>7. Logs</span>
                        <span class="admin-badge" id="logsBadge" style="display: none;">Admin</span>
                    </a>
                </li>
                <li class="nav-item" id="othersNavItem" style="display: none;">
                    <a class="nav-link" onclick="showContent('others', event)">
                        <i></i>
                        <span>8. Others</span>
                        <span class="admin-badge">Admin</span>
                    </a>
                </li>
            </ul>
            
            <div class="ego-quote">
                <p>"The only one who can beat me is me."</p>
                <small>- Jinpachi Ego</small>
            </div>
        </aside>
        
        <!-- Main Content -->
        <main class="main-content">
            <!-- Header - Click to login (only shows when not logged in) -->
            <header class="header" id="loginHeader" onclick="showLoginModal()">
                <div class="page-title">
                    <h1 id="pageTitle">Guide</h1>
                </div>
                
                <div class="user-profile">
                    <div class="user-info">
                        <div class="user-name" id="userName">Visitor</div>
                        <div class="user-role" id="userRole">Click to Login</div>
                    </div>
                    <div class="user-avatar" id="userAvatar">V</div>
                </div>
            </header>
            
            <!-- Content Area -->
            <div class="content-area" id="contentArea">
                <div class="content-placeholder">
                    <h2>Welcome to Blue Lock Manager</h2>
                    <p>Select a section from the sidebar to get started.</p>
                </div>
            </div>
        </main>
    </div>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCoCEZO_JbwHxHewSYgd319SPkAL-a-Nh0",
            authDomain: "project-ds-manager.firebaseapp.com",
            databaseURL: "https://project-ds-manager-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "project-ds-manager",
            storageBucket: "project-ds-manager.firebasestorage.app",
            messagingSenderId: "395667109343",
            appId: "1:395667109343:web:14164c3e08ee672acdc06a"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const database = firebase.database();

        let isAdmin = false;
        let currentUser = null;
        let currentEditingMatch = null;
        let isEditingResults = false;
        let lastHypeTime = {}; // Track last hype time per player
        let transferHistory = {}; // Track player transfers

        // Format number to compact (e.g., 1.5M, 2.3B)
        function formatCompactNumber(num) {
            if (num === null || num === undefined) return '0';
            if (num >= 1000000) {
                return (num / 1000000).toFixed(1) + 'M';
            }
            if (num >= 1000) {
                return (num / 1000).toFixed(1) + 'K';
            }
            return num.toString();
        }

        // Hide loading spinner when page is ready
        window.addEventListener('load', function() {
            setTimeout(() => {
                document.getElementById('loadingSpinner').style.display = 'none';
            }, 500);
        });

        // Start as visitor by default
        window.addEventListener('DOMContentLoaded', function() {
            // Set default visitor state
            isAdmin = false;
            currentUser = { isVisitor: true };
            document.getElementById('userName').textContent = 'Visitor';
            document.getElementById('userRole').textContent = 'Click to Login';
            document.getElementById('userAvatar').textContent = 'V';
            document.getElementById('logoutBtn').classList.add('hidden');
            
            // Hide admin badges
            document.querySelectorAll('.admin-badge').forEach(badge => {
                badge.style.display = 'none';
            });
            document.getElementById('othersNavItem').style.display = 'none';
            
            // Load guide by default
            loadGuideContent();
        });

        // Theme functions
        function setTheme(theme, button) {
            document.body.setAttribute('data-theme', theme);
            localStorage.setItem('theme', theme);
            
            // Update toggle buttons
            document.querySelectorAll('.theme-toggle button').forEach(btn => {
                btn.classList.remove('active');
            });
            button.classList.add('active');
        }

        // Load saved theme
        const savedTheme = localStorage.getItem('theme') || 'light';
        document.body.setAttribute('data-theme', savedTheme);
        
        // Update active theme button
        document.querySelectorAll('.theme-toggle button').forEach(btn => {
            if ((savedTheme === 'light' && btn.textContent.includes('Light')) ||
                (savedTheme === 'dark' && btn.textContent.includes('Dark'))) {
                btn.classList.add('active');
            }
        });

        // Show login modal
        function showLoginModal() {
            if (!isAdmin) {
                document.getElementById('loginModal').classList.add('active');
            }
        }

        // Check auth state
        auth.onAuthStateChanged((user) => {
            if (user) {
                // Admin logged in
                isAdmin = true;
                currentUser = user;
                document.getElementById('loginModal').classList.remove('active');
                document.getElementById('loginHeader').style.cursor = 'default';
                document.getElementById('userName').textContent = user.email.split('@')[0];
                document.getElementById('userRole').textContent = 'Administrator';
                document.getElementById('userAvatar').textContent = user.email.charAt(0).toUpperCase();
                document.getElementById('logoutBtn').classList.remove('hidden');
                
                // Show admin badges and Others tab
                document.querySelectorAll('.admin-badge').forEach(badge => {
                    badge.style.display = 'inline';
                });
                document.getElementById('othersNavItem').style.display = 'block';
                
                // Reload current content with admin view
                const currentPage = document.getElementById('pageTitle').textContent.toLowerCase();
                if (currentPage === 'guide') {
                    loadGuideContent();
                } else if (currentPage === 'registry') {
                    loadRegistryContent();
                } else if (currentPage === 'fixtures') {
                    loadFixturesContent();
                } else if (currentPage === 'results') {
                    loadResultsContent();
                } else if (currentPage === 'team-lb') {
                    loadTeamLBContent();
                } else if (currentPage.includes('most-')) {
                    loadPlayerLBContent(currentPage);
                } else if (currentPage === 'logs') {
                    loadLogsContent();
                }
            } else {
                // No user, visitor mode
                isAdmin = false;
                currentUser = { isVisitor: true };
                document.getElementById('loginHeader').style.cursor = 'pointer';
                document.getElementById('userName').textContent = 'Visitor';
                document.getElementById('userRole').textContent = 'Click to Login';
                document.getElementById('userAvatar').textContent = 'V';
                document.getElementById('logoutBtn').classList.add('hidden');
                
                // Hide admin badges
                document.querySelectorAll('.admin-badge').forEach(badge => {
                    badge.style.display = 'none';
                });
                document.getElementById('othersNavItem').style.display = 'none';
            }
        });

        // Login function
        function login() {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const errorElement = document.getElementById('errorMessage');

            if (!email || !password) {
                errorElement.textContent = 'Please enter email and password';
                return;
            }

            auth.signInWithEmailAndPassword(email, password)
                .then(() => {
                    // Log the login action
                    logAction('Admin Login', 'Authentication');
                })
                .catch((error) => {
                    errorElement.textContent = error.message;
                });
        }

        // Logout function
        function logout() {
            if (isAdmin) {
                auth.signOut();
            }
        }

        // Log admin actions
        function logAction(action, section) {
            if (!isAdmin || !currentUser) return;
            
            const logId = Date.now().toString();
            const logEntry = {
                action: action,
                user: currentUser.email,
                timestamp: Date.now(),
                section: section || 'General'
            };
            
            database.ref(`logs/${logId}`).set(logEntry).catch(error => {
                console.error('Error logging action:', error);
            });
        }

        // Mask email for display
        function maskEmail(email) {
            if (!email) return 'Unknown';
            const [localPart, domain] = email.split('@');
            if (localPart.length <= 5) {
                return '*'.repeat(localPart.length) + '@' + domain;
            }
            return localPart.substring(0, 5) + '*'.repeat(localPart.length - 5) + '@' + domain;
        }

        // Toggle submenu
        function toggleSubmenu(event) {
            event.preventDefault();
            const submenu = document.getElementById('playerLBSubmenu');
            submenu.classList.toggle('active');
        }

        // Show content based on selection
        function showContent(section, event) {
            event.preventDefault();
            const contentArea = document.getElementById('contentArea');
            const pageTitle = document.getElementById('pageTitle');
            
            // Update active nav link
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
            });
            event.currentTarget.classList.add('active');
            
            // Set page title
            const titles = {
                'guide': 'Guide',
                'registry': 'Registry',
                'fixtures': 'Fixtures',
                'results': 'Results',
                'team-lb': 'Team Leaderboard',
                'most-goals': 'Most Goals',
                'most-assists': 'Most Assists',
                'most-saves': 'Most Saves',
                'most-awards': 'Most Awards',
                'most-valued': 'Most Valued',
                'logs': 'Logs',
                'others': 'Others'
            };
            
            pageTitle.textContent = titles[section] || section;
            
            // Load content
            if (section === 'guide') {
                loadGuideContent();
            } else if (section === 'registry') {
                loadRegistryContent();
            } else if (section === 'fixtures') {
                loadFixturesContent();
            } else if (section === 'results') {
                loadResultsContent();
            } else if (section === 'team-lb') {
                loadTeamLBContent();
            } else if (section === 'logs') {
                loadLogsContent();
            } else if (section === 'others') {
                loadOthersContent();
            } else if (section.includes('most-')) {
                loadPlayerLBContent(section);
            } else {
                loadGenericContent(section);
            }
        }

        // Load Registry content with team colors
        function loadRegistryContent() {
            const contentArea = document.getElementById('contentArea');
            
            // --- Visitor check for completely restricted tabs is done in showContent, but logs/others are blocked.
            // For registry, visitors can view but with admin sections hidden.
            
            // Show loading state
            contentArea.innerHTML = `
                <div class="content-placeholder">
                    <div class="spinner" style="width: 30px; height: 30px; margin: 0 auto 1rem;"></div>
                    <p>Loading registry...</p>
                </div>
            `;
            
            // Load teams and players
            Promise.all([
                database.ref('registry/teams').once('value'),
                database.ref('registry/players').once('value'),
                database.ref('settings/values').once('value')
            ]).then(([teamsSnapshot, playersSnapshot, settingsSnapshot]) => {
                const teams = teamsSnapshot.val() || {};
                const players = playersSnapshot.val() || {};
                
                // Handle settings data structure
                const settingsData = settingsSnapshot.val() || {};
                const settings = {
                    goalValue: settingsData.goalValue || 100000,
                    assistValue: settingsData.assistValue || 100000,
                    saveValue: settingsData.saveValue || 100000
                };
                
                let html = `
                    <div class="success-message" id="successMessage">
                        <i class="fas fa-check-circle"></i> Operation completed successfully!
                    </div>
                `;

                // ---- Admin-only sections ----
                if (isAdmin) {
                    html += `
                        <!-- Team Registration -->
                        <div class="registration-section">
                            <h2><i class="fas fa-shield-alt"></i> Team Registration</h2>
                            <div class="registration-grid">
                                <div class="registration-card">
                                    <h3>Register New Team</h3>
                                    <div class="form-group">
                                        <label>Team Name</label>
                                        <input type="text" id="teamName" placeholder="e.g., Team Isagi">
                                    </div>
                                    <div class="form-group">
                                        <label>Team Color</label>
                                        <div class="color-input-group">
                                            <input type="color" id="teamColor" value="#0a1c3a">
                                            <input type="text" id="teamColorHex" value="#0a1c3a" placeholder="#RRGGBB">
                                        </div>
                                    </div>
                                    <button class="btn" onclick="registerTeam()">
                                        <i class="fas fa-plus"></i> Register Team
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Player Registration -->
                        <div class="registration-section">
                            <h2><i class="fas fa-user"></i> Player Registration</h2>
                            <div class="registration-grid">
                                <div class="registration-card">
                                    <h3>Add Single Player</h3>
                                    <div class="form-group">
                                        <label>Player Name</label>
                                        <input type="text" id="playerName" placeholder="e.g., Yoichi Isagi">
                                    </div>
                                    <div class="form-group">
                                        <label>Select Team</label>
                                        <select id="playerTeam">
                                            <option value="">Select a team...</option>
                                            ${Object.entries(teams).map(([id, team]) => 
                                                `<option value="${id}" style="color: ${team.color}">${team.name}</option>`
                                            ).join('')}
                                        </select>
                                    </div>
                                    <button class="btn" onclick="addPlayer()">
                                        <i class="fas fa-user-plus"></i> Add Player
                                    </button>
                                </div>
                                
                                <div class="registration-card">
                                    <h3>Bulk Add Players</h3>
                                    <p class="warning-text">Enter one player name per line</p>
                                    <textarea id="bulkPlayers" rows="5" placeholder="Yoichi Isagi&#10;Meguru Bachira&#10;Rin Itoshi"></textarea>
                                    <div class="form-group">
                                        <label>Select Team for All</label>
                                        <select id="bulkTeam">
                                            <option value="">Select a team...</option>
                                            ${Object.entries(teams).map(([id, team]) => 
                                                `<option value="${id}" style="color: ${team.color}">${team.name}</option>`
                                            ).join('')}
                                        </select>
                                    </div>
                                    <button class="btn btn-success" onclick="bulkAddPlayers()">
                                        <i class="fas fa-layer-group"></i> Bulk Add Players
                                    </button>
                                </div>
                            </div>
                        </div>
                    `;
                }

                // Teams List (visible to everyone)
                html += `
                    <div class="registration-section">
                        <h2><i class="fas fa-list"></i> Registered Teams</h2>
                        <div class="teams-list" id="teamsList">
                `;
                
                // Add teams
                if (Object.keys(teams).length === 0) {
                    html += `<p class="warning-text">No teams registered yet. Register a team above.</p>`;
                } else {
                    Object.entries(teams).forEach(([teamId, team]) => {
                        const teamPlayers = Object.entries(players)
                            .filter(([_, player]) => player.teamId === teamId)
                            .map(([id, player]) => ({ id, ...player }));
                        
                        html += `
                            <div class="team-card" style="border-left-color: ${team.color || '#0a1c3a'}" id="team-${teamId}">
                                <div class="team-header">
                                    <div class="team-title">
                                        <div class="team-color" style="background-color: ${team.color || '#0a1c3a'}; box-shadow: 0 0 10px ${team.color || '#0a1c3a'};"></div>
                                        <span class="team-name" style="color: ${team.color || '#0a1c3a'}; text-shadow: 0 0 10px ${team.color || '#0a1c3a'};">${team.name}</span>
                                    </div>
                        `;
                        
                        // Admin controls for team (edit/delete)
                        if (isAdmin) {
                            html += `
                                    <div class="team-controls">
                                        <button class="btn-edit" onclick="editTeam('${teamId}')">
                                            <i class="fas fa-edit"></i> Edit
                                        </button>
                                        <button class="btn-delete" onclick="deleteTeam('${teamId}')">
                                            <i class="fas fa-trash"></i> Delete
                                        </button>
                                    </div>
                            `;
                        }
                        
                        html += `</div>
                                
                                <div class="player-row header">
                                    <div>Player</div>
                                    <div>Goals</div>
                                    <div>Assists</div>
                                    <div>Saves</div>
                                    <div>Value</div>
                                    <div>Legs</div>
                                    <div></div>
                                    <div></div>
                                </div>
                        `;
                        
                        // Add players
                        if (teamPlayers.length === 0) {
                            html += `<p class="warning-text" style="padding: 1rem;">No players in this team yet.</p>`;
                        } else {
                            teamPlayers.forEach(player => {
                                const value = (player.goals || 0) * settings.goalValue +
                                             (player.assists || 0) * settings.assistValue +
                                             (player.saves || 0) * settings.saveValue;
                                
                                html += `
                                    <div class="player-row" id="player-${player.id}" onclick="showPlayerProfile('${player.id}')">
                                        <div class="player-name" style="color: ${team.color || '#0a1c3a'}">${player.name}</div>
                                        <div class="stat-display">${player.goals || 0}</div>
                                        <div class="stat-display">${player.assists || 0}</div>
                                        <div class="stat-display">${player.saves || 0}</div>
                                        <div class="value-display">$${formatCompactNumber(value)}</div>
                                        <div class="stat-display">${player.legs || 0}</div>
                                `;
                                
                                // Admin-only player action buttons
                                if (isAdmin) {
                                    html += `
                                        <div>
                                            <button class="btn-edit btn-small" onclick="event.stopPropagation(); editPlayer('${player.id}')">
                                                <i class="fas fa-edit"></i>
                                            </button>
                                        </div>
                                        <div>
                                            <button class="btn-delete btn-small" onclick="event.stopPropagation(); deletePlayer('${player.id}')">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </div>
                                    `;
                                } else {
                                    // Empty cells to maintain grid
                                    html += `<div></div><div></div>`;
                                }
                                
                                html += `</div>`;
                            });
                        }
                        
                        html += `</div>`;
                    });
                }
                
                html += `
                        </div>
                    </div>
                `;
                
                contentArea.innerHTML = html;
                
                // Add color picker sync (only if admin and elements exist)
                if (isAdmin) {
                    const colorInput = document.getElementById('teamColor');
                    const colorHex = document.getElementById('teamColorHex');
                    if (colorInput && colorHex) {
                        colorInput.addEventListener('input', (e) => {
                            colorHex.value = e.target.value;
                        });
                        colorHex.addEventListener('input', (e) => {
                            if (/^#[0-9A-F]{6}$/i.test(e.target.value)) {
                                colorInput.value = e.target.value;
                            }
                        });
                    }
                }
            }).catch((error) => {
                contentArea.innerHTML = `
                    <div class="content-placeholder">
                        <h2>Error Loading Registry</h2>
                        <p>${error.message}</p>
                    </div>
                `;
            });
        }

        // Register new team (admin only)
        function registerTeam() {
            if (!isAdmin) return;
            const name = document.getElementById('teamName').value;
            const color = document.getElementById('teamColor').value;
            
            if (!name) {
                alert('Please enter a team name');
                return;
            }
            
            const teamId = Date.now().toString();
            const team = {
                name: name,
                color: color,
                createdAt: Date.now(),
                createdBy: currentUser?.email || 'admin'
            };
            
            database.ref(`registry/teams/${teamId}`).set(team)
                .then(() => {
                    logAction(`Registered new team: ${name}`, 'Registry');
                    showSuccessMessage('Team registered successfully!');
                    document.getElementById('teamName').value = '';
                    loadRegistryContent();
                })
                .catch((error) => {
                    alert('Error registering team: ' + error.message);
                });
        }

        // Add single player (admin only)
        function addPlayer() {
            if (!isAdmin) return;
            const name = document.getElementById('playerName').value;
            const teamId = document.getElementById('playerTeam').value;
            
            if (!name) {
                alert('Please enter a player name');
                return;
            }
            
            if (!teamId) {
                alert('Please select a team');
                return;
            }
            
            const playerId = Date.now().toString();
            const player = {
                name: name,
                teamId: teamId,
                goals: 0,
                assists: 0,
                saves: 0,
                legs: 0,
                awards: 0,
                hype: 0,
                createdAt: Date.now(),
                createdBy: currentUser?.email || 'admin'
            };
            
            database.ref(`registry/players/${playerId}`).set(player)
                .then(() => {
                    logAction(`Added player: ${name}`, 'Registry');
                    showSuccessMessage('Player added successfully!');
                    document.getElementById('playerName').value = '';
                    document.getElementById('playerTeam').value = '';
                    loadRegistryContent();
                })
                .catch((error) => {
                    alert('Error adding player: ' + error.message);
                });
        }

        // Bulk add players (admin only)
        function bulkAddPlayers() {
            if (!isAdmin) return;
            const namesText = document.getElementById('bulkPlayers').value;
            const teamId = document.getElementById('bulkTeam').value;
            
            if (!namesText) {
                alert('Please enter player names');
                return;
            }
            
            if (!teamId) {
                alert('Please select a team');
                return;
            }
            
            const names = namesText.split('\n').filter(name => name.trim() !== '');
            
            if (names.length === 0) {
                alert('Please enter at least one player name');
                return;
            }
            
            const updates = {};
            const timestamp = Date.now();
            
            names.forEach(name => {
                const playerId = timestamp + Math.random().toString(36).substr(2, 9);
                updates[`registry/players/${playerId}`] = {
                    name: name.trim(),
                    teamId: teamId,
                    goals: 0,
                    assists: 0,
                    saves: 0,
                    legs: 0,
                    awards: 0,
                    hype: 0,
                    createdAt: timestamp,
                    createdBy: currentUser?.email || 'admin'
                };
            });
            
            database.ref().update(updates)
                .then(() => {
                    logAction(`Bulk added ${names.length} players`, 'Registry');
                    showSuccessMessage(`${names.length} players added successfully!`);
                    document.getElementById('bulkPlayers').value = '';
                    document.getElementById('bulkTeam').value = '';
                    loadRegistryContent();
                })
                .catch((error) => {
                    alert('Error adding players: ' + error.message);
                });
        }

        // Edit team (admin only)
        function editTeam(teamId) {
            if (!isAdmin) return;
            const newName = prompt('Enter new team name:');
            if (newName) {
                database.ref(`registry/teams/${teamId}/name`).set(newName)
                    .then(() => {
                        logAction(`Renamed team to: ${newName}`, 'Registry');
                        showSuccessMessage('Team updated successfully!');
                        loadRegistryContent();
                    })
                    .catch((error) => {
                        alert('Error updating team: ' + error.message);
                    });
            }
        }

        // Delete team (admin only)
        function deleteTeam(teamId) {
            if (!isAdmin) return;
            if (confirm('Are you sure you want to delete this team? All players in this team will also be deleted!')) {
                // First, get all players in this team
                database.ref('registry/players').once('value')
                    .then((snapshot) => {
                        const players = snapshot.val() || {};
                        const updates = {};
                        
                        // Mark team for deletion
                        updates[`registry/teams/${teamId}`] = null;
                        
                        // Mark all players in this team for deletion
                        Object.entries(players).forEach(([id, player]) => {
                            if (player.teamId === teamId) {
                                updates[`registry/players/${id}`] = null;
                            }
                        });
                        
                        return database.ref().update(updates);
                    })
                    .then(() => {
                        logAction(`Deleted team and its players`, 'Registry');
                        showSuccessMessage('Team and all its players deleted successfully!');
                        loadRegistryContent();
                    })
                    .catch((error) => {
                        alert('Error deleting team: ' + error.message);
                    });
            }
        }

        // Edit player with transfer option (admin only)
        function editPlayer(playerId) {
            if (!isAdmin) return;
            // First, get current player data and all teams
            Promise.all([
                database.ref(`registry/players/${playerId}`).once('value'),
                database.ref('registry/teams').once('value')
            ]).then(([playerSnapshot, teamsSnapshot]) => {
                const player = playerSnapshot.val();
                const teams = teamsSnapshot.val() || {};
                
                if (!player) {
                    alert('Player not found');
                    return;
                }
                
                // Create modal for editing player
                const modal = document.createElement('div');
                modal.className = 'modal active';
                modal.style.zIndex = '3000';
                
                let teamOptions = '<option value="">Select a team...</option>';
                Object.entries(teams).forEach(([id, team]) => {
                    const selected = id === player.teamId ? 'selected' : '';
                    teamOptions += `<option value="${id}" ${selected} style="color: ${team.color}">${team.name}</option>`;
                });
                
                modal.innerHTML = `
                    <div class="modal-content">
                        <div class="modal-header">
                            <h2>Edit Player</h2>
                            <p>${player.name}</p>
                        </div>
                        
                        <div class="form-group">
                            <label>Player Name</label>
                            <input type="text" id="editPlayerName" value="${player.name}">
                        </div>
                        
                        <div class="form-group">
                            <label>Transfer to Team</label>
                            <select id="editPlayerTeam">
                                ${teamOptions}
                            </select>
                        </div>
                        
                        <div style="display: flex; gap: 1rem; margin-top: 2rem;">
                            <button class="btn" onclick="savePlayerChanges('${playerId}')">Save Changes</button>
                            <button class="btn btn-secondary" onclick="this.closest('.modal').remove()">Cancel</button>
                        </div>
                        
                        <p style="margin-top: 1rem; color: var(--text-light); font-size: 0.8rem; text-align: center;">
                            <i class="fas fa-info-circle"></i> Stats can only be updated through match results
                        </p>
                    </div>
                `;
                
                document.body.appendChild(modal);
            }).catch((error) => {
                alert('Error loading player data: ' + error.message);
            });
        }

        // Save player changes after edit (admin only)
        function savePlayerChanges(playerId) {
            if (!isAdmin) return;
            const newName = document.getElementById('editPlayerName').value;
            const newTeamId = document.getElementById('editPlayerTeam').value;
            
            if (!newName) {
                alert('Please enter a player name');
                return;
            }
            
            if (!newTeamId) {
                alert('Please select a team');
                return;
            }
            
            // Get current player data to record transfer
            database.ref(`registry/players/${playerId}`).once('value')
                .then((snapshot) => {
                    const player = snapshot.val();
                    if (!player) return;
                    
                    // Record transfer if team changed
                    if (player.teamId !== newTeamId) {
                        const transferId = Date.now().toString();
                        const transfer = {
                            playerId: playerId,
                            fromTeam: player.teamId,
                            toTeam: newTeamId,
                            date: Date.now()
                        };
                        
                        // Initialize transfer history for this player if needed
                        if (!transferHistory[playerId]) {
                            transferHistory[playerId] = [];
                        }
                        transferHistory[playerId].push(transfer);
                    }
                    
                    const updates = {
                        name: newName,
                        teamId: newTeamId,
                        updatedAt: Date.now()
                    };
                    
                    return database.ref(`registry/players/${playerId}`).update(updates);
                })
                .then(() => {
                    logAction(`Updated player: ${newName}`, 'Registry');
                    // Close modal
                    document.querySelector('.modal.active').remove();
                    showSuccessMessage('Player updated successfully!');
                    loadRegistryContent();
                })
                .catch((error) => {
                    alert('Error updating player: ' + error.message);
                });
        }

        // Delete player (admin only)
        function deletePlayer(playerId) {
            if (!isAdmin) return;
            if (confirm('Are you sure you want to delete this player?')) {
                database.ref(`registry/players/${playerId}`).remove()
                    .then(() => {
                        logAction(`Deleted player`, 'Registry');
                        showSuccessMessage('Player deleted successfully!');
                        loadRegistryContent();
                    })
                    .catch((error) => {
                        alert('Error deleting player: ' + error.message);
                    });
            }
        }

        // Show Player Profile (everyone can view)
        function showPlayerProfile(playerId) {
            Promise.all([
                database.ref(`registry/players/${playerId}`).once('value'),
                database.ref('registry/teams').once('value'),
                database.ref('results').once('value'),
                database.ref('settings/values').once('value')
            ]).then(([playerSnapshot, teamsSnapshot, resultsSnapshot, settingsSnapshot]) => {
                const player = playerSnapshot.val();
                const teams = teamsSnapshot.val() || {};
                const results = resultsSnapshot.val() || {};
                const settings = settingsSnapshot.val() || {};
                
                if (!player) {
                    alert('Player not found');
                    return;
                }
                
                const currentTeam = teams[player.teamId] || { name: 'Unknown', color: '#0a1c3a' };
                
                // Calculate value
                const value = (player.goals || 0) * (settings.goalValue || 100000) +
                             (player.assists || 0) * (settings.assistValue || 100000) +
                             (player.saves || 0) * (settings.saveValue || 100000);
                
                // Get match history
                const matchHistory = [];
                
                Object.entries(results).forEach(([resultId, result]) => {
                    if (result.playerStats && result.playerStats[playerId]) {
                        const stats = result.playerStats[playerId];
                        const homeTeam = teams[result.homeTeam] || { name: result.homeTeam };
                        const awayTeam = teams[result.awayTeam] || { name: result.awayTeam };
                        const opponent = stats.team === 'home' ? awayTeam.name : homeTeam.name;
                        
                        matchHistory.push({
                            date: new Date(result.timestamp).toLocaleDateString(),
                            opponent: opponent,
                            team: stats.team === 'home' ? homeTeam.name : awayTeam.name,
                            legs: stats.legs,
                            goals: stats.goals,
                            assists: stats.assists,
                            saves: stats.saves,
                            mvp: result.mvp === playerId,
                            motm: result.motm === playerId
                        });
                    }
                });
                
                // Sort match history by date (newest first)
                matchHistory.sort((a, b) => new Date(b.date) - new Date(a.date));
                
                // Get transfer history
                const playerTransfers = transferHistory[playerId] || [];
                
                // Create modal
                const modal = document.createElement('div');
                modal.className = 'modal active';
                
                let matchHistoryHtml = '';
                if (matchHistory.length > 0) {
                    matchHistory.slice(0, 5).forEach(match => {
                        matchHistoryHtml += `
                            <div class="history-card">
                                <div class="history-header">
                                    <span class="history-badge ${match.mvp ? 'mvp' : (match.motm ? 'motm' : '')}">
                                        ${match.mvp ? 'MVP' : (match.motm ? 'MOTM' : '')}
                                    </span>
                                    <span>${match.date}</span>
                                </div>
                                <div class="history-teams">${match.team} vs ${match.opponent}</div>
                                <div class="history-stats">
                                    <span>${match.legs === 'full' ? 'Full' : (match.legs === 'dnp' ? 'DNP' : '1 Leg')}</span>
                                    <span>${match.goals}G / ${match.assists}A / ${match.saves}S</span>
                                </div>
                            </div>
                        `;
                    });
                } else {
                    matchHistoryHtml = '<p class="warning-text">No match history yet.</p>';
                }
                
                // Build transfer history HTML
                let transferHistoryHtml = '';
                if (playerTransfers.length > 0) {
                    playerTransfers.forEach(transfer => {
                        const fromTeam = teams[transfer.fromTeam] || { name: 'Unknown', color: '#0a1c3a' };
                        const toTeam = teams[transfer.toTeam] || { name: 'Unknown', color: '#0a1c3a' };
                        transferHistoryHtml += `
                            <div class="transfer-item">
                                <div class="transfer-teams">
                                    <span style="color: ${fromTeam.color}">${fromTeam.name}</span>
                                    <span class="transfer-arrow"></span>
                                    <span style="color: ${toTeam.color}">${toTeam.name}</span>
                                </div>
                                <div class="transfer-date">${new Date(transfer.date).toLocaleDateString()}</div>
                            </div>
                        `;
                    });
                }
                
                // Add current team to transfer history
                transferHistoryHtml += `
                    <div class="transfer-item">
                        <div class="transfer-teams">
                            <span style="color: ${currentTeam.color}">${currentTeam.name}</span>
                            <span class="transfer-arrow"></span>
                            <span>Current Team</span>
                        </div>
                        <div class="transfer-date">Present</div>
                    </div>
                `;
                
                // Check if hype is available (24h cooldown)
                const lastHype = lastHypeTime[playerId] || 0;
                const canHype = Date.now() - lastHype > 24 * 60 * 60 * 1000;
                
                modal.innerHTML = `
                    <div class="modal-content player-profile">
                        <div class="profile-header">
                            <div class="profile-title">
                                <h2>${player.name}</h2>
                                <div class="team-name" style="color: ${currentTeam.color}; text-shadow: 0 0 10px ${currentTeam.color};">${currentTeam.name}</div>
                            </div>
                            <div class="profile-value">
                                <div class="label">Total Value</div>
                                <div class="amount">$${formatCompactNumber(value)}</div>
                            </div>
                        </div>
                        
                        <div class="profile-stats">
                            <div class="profile-stat">
                                <div class="value" style="color: var(--isagi-blue); text-shadow: 0 0 10px var(--isagi-blue);">${player.goals || 0}</div>
                                <div class="label">Goals</div>
                            </div>
                            <div class="profile-stat">
                                <div class="value" style="color: var(--bachira-yellow); text-shadow: 0 0 10px var(--bachira-yellow);">${player.assists || 0}</div>
                                <div class="label">Assists</div>
                            </div>
                            <div class="profile-stat">
                                <div class="value" style="color: var(--gagamaru-silver); text-shadow: 0 0 10px var(--gagamaru-silver);">${player.saves || 0}</div>
                                <div class="label">Saves</div>
                            </div>
                            <div class="profile-stat">
                                <div class="value" style="color: var(--accent-blue); text-shadow: 0 0 10px var(--accent-blue);">${player.legs || 0}</div>
                                <div class="label">Legs</div>
                            </div>
                            <div class="profile-stat">
                                <div class="value" style="color: var(--mvp-purple); text-shadow: 0 0 10px var(--mvp-purple);">${player.awards || 0}</div>
                                <div class="label">Awards</div>
                            </div>
                            <div class="profile-stat">
                                <div class="value" style="color: var(--hype-pink); text-shadow: 0 0 10px var(--hype-pink);">${player.hype || 0} <span class="hype-count"></span></div>
                                <div class="label">Hype</div>
                            </div>
                        </div>
                        
                        <div class="profile-actions">
                            <button class="btn-hype" onclick="giveHype('${playerId}')" ${!canHype ? 'disabled' : ''}>
                                <i class="fas fa-fire"></i> HYPE ${!canHype ? '(24h cooldown)' : ''}
                            </button>
                            <button class="btn btn-secondary" onclick="comparePlayer('${playerId}')">
                                <i class="fas fa-chart-bar"></i> COMPARE
                            </button>
                        </div>
                        
                        <div class="leg-analysis">
                            <h3>LEG ANALYSIS</h3>
                            <div class="leg-stats">
                                <div class="leg-stat">
                                    <div class="value" style="color: var(--gold); text-shadow: 0 0 10px var(--gold);">${(player.goals / Math.max(player.legs, 1)).toFixed(2)}</div>
                                    <div class="label">G/Leg</div>
                                </div>
                                <div class="leg-stat">
                                    <div class="value" style="color: var(--gold); text-shadow: 0 0 10px var(--gold);">${(player.assists / Math.max(player.legs, 1)).toFixed(2)}</div>
                                    <div class="label">A/Leg</div>
                                </div>
                                <div class="leg-stat">
                                    <div class="value" style="color: var(--gold); text-shadow: 0 0 10px var(--gold);">${(player.saves / Math.max(player.legs, 1)).toFixed(2)}</div>
                                    <div class="label">S/Leg</div>
                                </div>
                                <div class="leg-stat">
                                    <div class="value" style="color: var(--success-green); text-shadow: 0 0 10px var(--neon-green);">$${formatCompactNumber(Math.round(value / Math.max(player.legs, 1)))}</div>
                                    <div class="label">Value/Leg</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="match-history">
                            <h3>MATCH HISTORY</h3>
                            ${matchHistoryHtml}
                        </div>
                        
                        <div class="transfer-record">
                            <h3>TRANSFER RECORD</h3>
                            ${transferHistoryHtml}
                        </div>
                        
                        <button class="btn btn-secondary" onclick="this.closest('.modal').remove()">Close</button>
                    </div>
                `;
                
                document.body.appendChild(modal);
            }).catch((error) => {
                alert('Error loading player data: ' + error.message);
            });
        }

        // Give hype to player (everyone can give, but cooldown per player)
        function giveHype(playerId) {
            const lastHype = lastHypeTime[playerId] || 0;
            if (Date.now() - lastHype < 24 * 60 * 60 * 1000) {
                alert('You can only give hype once every 24 hours!');
                return;
            }
            
            database.ref(`registry/players/${playerId}/hype`).transaction(current => (current || 0) + 1)
                .then(() => {
                    lastHypeTime[playerId] = Date.now();
                    logAction(`Gave hype to player`, 'Hype');
                    // Close current modal and reopen to update
                    document.querySelector('.modal.active').remove();
                    showPlayerProfile(playerId);
                })
                .catch((error) => {
                    alert('Error giving hype: ' + error.message);
                });
        }

        // Compare players (everyone can use)
        function comparePlayer(playerId) {
            Promise.all([
                database.ref(`registry/players/${playerId}`).once('value'),
                database.ref('registry/players').once('value'),
                database.ref('registry/teams').once('value'),
                database.ref('settings/values').once('value')
            ]).then(([playerSnapshot, allPlayersSnapshot, teamsSnapshot, settingsSnapshot]) => {
                const player1 = playerSnapshot.val();
                const allPlayers = allPlayersSnapshot.val() || {};
                const teams = teamsSnapshot.val() || {};
                const settings = settingsSnapshot.val() || {};
                
                if (!player1) return;
                
                // Create compare modal
                const modal = document.createElement('div');
                modal.className = 'modal active compare-modal';
                
                let playerOptions = '<option value="">Select player to compare...</option>';
                Object.entries(allPlayers).forEach(([id, p]) => {
                    if (id !== playerId) {
                        const team = teams[p.teamId] || { name: 'Unknown' };
                        playerOptions += `<option value="${id}">${p.name} (${team.name})</option>`;
                    }
                });
                
                modal.innerHTML = `
                    <div class="modal-content">
                        <div class="modal-header">
                            <h2>Compare Players</h2>
                            <p>${player1.name}</p>
                        </div>
                        
                        <div class="form-group compare-select">
                            <label>Select Player to Compare</label>
                            <select id="comparePlayerSelect">
                                ${playerOptions}
                            </select>
                        </div>
                        
                        <div id="compareResults" style="display: none;">
                            <!-- Results will be populated here -->
                        </div>
                        
                        <button class="btn" onclick="performComparison('${playerId}')">Compare</button>
                        <button class="btn btn-secondary" onclick="this.closest('.modal').remove()">Cancel</button>
                    </div>
                `;
                
                document.body.appendChild(modal);
            });
        }

        // Perform comparison (everyone can use)
        function performComparison(player1Id) {
            const player2Id = document.getElementById('comparePlayerSelect').value;
            if (!player2Id) {
                alert('Please select a player to compare');
                return;
            }
            
            Promise.all([
                database.ref(`registry/players/${player1Id}`).once('value'),
                database.ref(`registry/players/${player2Id}`).once('value'),
                database.ref('registry/teams').once('value'),
                database.ref('settings/values').once('value')
            ]).then(([p1Snapshot, p2Snapshot, teamsSnapshot, settingsSnapshot]) => {
                const player1 = p1Snapshot.val();
                const player2 = p2Snapshot.val();
                const teams = teamsSnapshot.val() || {};
                const settings = settingsSnapshot.val() || {};
                
                if (!player1 || !player2) return;
                
                const team1 = teams[player1.teamId] || { name: 'Unknown', color: '#0a1c3a' };
                const team2 = teams[player2.teamId] || { name: 'Unknown', color: '#0a1c3a' };
                
                // Calculate values
                const value1 = (player1.goals || 0) * (settings.goalValue || 100000) +
                              (player1.assists || 0) * (settings.assistValue || 100000) +
                              (player1.saves || 0) * (settings.saveValue || 100000);
                
                const value2 = (player2.goals || 0) * (settings.goalValue || 100000) +
                              (player2.assists || 0) * (settings.assistValue || 100000) +
                              (player2.saves || 0) * (settings.saveValue || 100000);
                
                const compareResults = document.getElementById('compareResults');
                compareResults.style.display = 'block';
                
                compareResults.innerHTML = `
                    <div class="compare-stats">
                        <div class="compare-player">
                            <h4 style="color: ${team1.color}; text-shadow: 0 0 10px ${team1.color};">${player1.name}</h4>
                            <div class="compare-stat-row ${player1.goals > player2.goals ? 'win' : (player1.goals < player2.goals ? 'lose' : '')}">
                                <span>Goals</span>
                                <span>${player1.goals || 0}</span>
                            </div>
                            <div class="compare-stat-row ${player1.assists > player2.assists ? 'win' : (player1.assists < player2.assists ? 'lose' : '')}">
                                <span>Assists</span>
                                <span>${player1.assists || 0}</span>
                            </div>
                            <div class="compare-stat-row ${player1.saves > player2.saves ? 'win' : (player1.saves < player2.saves ? 'lose' : '')}">
                                <span>Saves</span>
                                <span>${player1.saves || 0}</span>
                            </div>
                            <div class="compare-stat-row ${(player1.awards || 0) > (player2.awards || 0) ? 'win' : ((player1.awards || 0) < (player2.awards || 0) ? 'lose' : '')}">
                                <span>Awards</span>
                                <span>${player1.awards || 0}</span>
                            </div>
                            <div class="compare-stat-row ${(player1.hype || 0) > (player2.hype || 0) ? 'win' : ((player1.hype || 0) < (player2.hype || 0) ? 'lose' : '')}">
                                <span>Hype</span>
                                <span>${player1.hype || 0} </span>
                            </div>
                            <div class="compare-stat-row ${value1 > value2 ? 'win' : (value1 < value2 ? 'lose' : '')}">
                                <span>Value</span>
                                <span>$${formatCompactNumber(value1)}</span>
                            </div>
                        </div>
                        
                        <div class="compare-vs">VS</div>
                        
                        <div class="compare-player">
                            <h4 style="color: ${team2.color}; text-shadow: 0 0 10px ${team2.color};">${player2.name}</h4>
                            <div class="compare-stat-row ${player2.goals > player1.goals ? 'win' : (player2.goals < player1.goals ? 'lose' : '')}">
                                <span>Goals</span>
                                <span>${player2.goals || 0}</span>
                            </div>
                            <div class="compare-stat-row ${player2.assists > player1.assists ? 'win' : (player2.assists < player1.assists ? 'lose' : '')}">
                                <span>Assists</span>
                                <span>${player2.assists || 0}</span>
                            </div>
                            <div class="compare-stat-row ${player2.saves > player1.saves ? 'win' : (player2.saves < player1.saves ? 'lose' : '')}">
                                <span>Saves</span>
                                <span>${player2.saves || 0}</span>
                            </div>
                            <div class="compare-stat-row ${(player2.awards || 0) > (player1.awards || 0) ? 'win' : ((player2.awards || 0) < (player1.awards || 0) ? 'lose' : '')}">
                                <span>Awards</span>
                                <span>${player2.awards || 0}</span>
                            </div>
                            <div class="compare-stat-row ${(player2.hype || 0) > (player1.hype || 0) ? 'win' : ((player2.hype || 0) < (player1.hype || 0) ? 'lose' : '')}">
                                <span>Hype</span>
                                <span>${player2.hype || 0} </span>
                            </div>
                            <div class="compare-stat-row ${value2 > value1 ? 'win' : (value2 < value1 ? 'lose' : '')}">
                                <span>Value</span>
                                <span>$${formatCompactNumber(value2)}</span>
                            </div>
                        </div>
                    </div>
                `;
            });
        }

        // Load Fixtures content
        function loadFixturesContent() {
            const contentArea = document.getElementById('contentArea');
            
            // Show loading state
            contentArea.innerHTML = `
                <div class="content-placeholder">
                    <div class="spinner" style="width: 30px; height: 30px; margin: 0 auto 1rem;"></div>
                    <p>Loading fixtures...</p>
                </div>
            `;
            
            // Load matchdays and fixtures
            Promise.all([
                database.ref('fixtures/matchdays').once('value'),
                database.ref('registry/teams').once('value')
            ]).then(([matchdaysSnapshot, teamsSnapshot]) => {
                const matchdays = matchdaysSnapshot.val() || {};
                const teams = teamsSnapshot.val() || {};
                
                let html = `
                    <div class="success-message" id="successMessage">
                        <i class="fas fa-check-circle"></i> Operation completed successfully!
                    </div>
                `;

                // Admin-only: Create Matchday
                if (isAdmin) {
                    html += `
                        <!-- Create Matchday -->
                        <div class="matchday-section">
                            <h2><i class="fas fa-calendar-plus"></i> Create Matchday</h2>
                            <div class="registration-grid">
                                <div class="registration-card">
                                    <h3>New Matchday</h3>
                                    <div class="form-group">
                                        <label>Matchday Name</label>
                                        <input type="text" id="matchdayName" placeholder="e.g., Matchday 1">
                                    </div>
                                    <div class="form-group">
                                        <label>Date</label>
                                        <input type="date" id="matchdayDate">
                                    </div>
                                    <button class="btn" onclick="createMatchday()">
                                        <i class="fas fa-plus"></i> Create Matchday
                                    </button>
                                </div>
                            </div>
                        </div>
                    `;
                }
                
                // Display matchdays (visible to everyone)
                if (Object.keys(matchdays).length === 0) {
                    html += `<p class="warning-text">No matchdays created yet. ${isAdmin ? 'Create a matchday above.' : 'Check back later.'}</p>`;
                } else {
                    Object.entries(matchdays).forEach(([matchdayId, matchday]) => {
                        const matches = matchday.matches || {};
                        
                        html += `
                            <div class="matchday-section" id="matchday-${matchdayId}">
                                <div class="matchday-header" onclick="toggleMatchday('${matchdayId}')">
                                    <div class="matchday-title">
                                        <i class="fas fa-chevron-right" id="chevron-${matchdayId}"></i>
                                        ${matchday.name} - ${new Date(matchday.date).toLocaleDateString()}
                                    </div>
                        `;
                        
                        // Admin controls for matchday (only visible to admin)
                        if (isAdmin) {
                            html += `
                                    <div class="matchday-controls">
                                        <button class="btn-edit" onclick="event.stopPropagation(); addMatch('${matchdayId}')">
                                            <i class="fas fa-plus"></i> Add Match
                                        </button>
                                        <button class="btn-delete" onclick="event.stopPropagation(); deleteMatchday('${matchdayId}')">
                                            <i class="fas fa-trash"></i> Delete
                                        </button>
                                    </div>
                            `;
                        }
                        
                        html += `</div>
                                
                                <div class="matchday-matches" id="matches-${matchdayId}" style="display: none;">
                        `;
                        
                        if (Object.keys(matches).length === 0) {
                            html += `<p class="warning-text">No matches in this matchday yet.</p>`;
                        } else {
                            Object.entries(matches).forEach(([matchId, match]) => {
                                const homeTeam = teams[match.homeTeam] || { name: 'Unknown', color: '#0a1c3a' };
                                const awayTeam = teams[match.awayTeam] || { name: 'Unknown', color: '#0a1c3a' };
                                const status = match.status || 'scheduled';
                                const statusClass = status === 'completed' ? 'status-completed' : 'status-scheduled';
                                const statusText = status === 'completed' ? 'MATCH OVER' : 'Scheduled';
                                
                                html += `
                                    <div class="match-card" id="match-${matchId}">
                                        <div class="match-info">
                                            <div class="match-teams">
                                                <span style="color: ${homeTeam.color}; text-shadow: 0 0 10px ${homeTeam.color};">${homeTeam.name}</span>
                                                <span>vs</span>
                                                <span style="color: ${awayTeam.color}; text-shadow: 0 0 10px ${awayTeam.color};">${awayTeam.name}</span>
                                            </div>
                                            <div class="match-status ${statusClass}">${statusText}</div>
                                        </div>
                                `;
                                
                                // Admin-only match actions
                                if (isAdmin) {
                                    html += `
                                        <div class="match-actions">
                                            <button class="btn-edit btn-small" onclick="editMatch('${matchdayId}', '${matchId}')">
                                                <i class="fas fa-edit"></i>
                                            </button>
                                            ${status !== 'completed' ? `
                                                <button class="btn-success btn-small" onclick="enterResults('${matchdayId}', '${matchId}')">
                                                    <i class="fas fa-chart-line"></i> Enter Results
                                                </button>
                                            ` : `
                                                <button class="btn-edit btn-small" onclick="editResults('${matchdayId}', '${matchId}')">
                                                    <i class="fas fa-pen"></i> Edit Results
                                                </button>
                                            `}
                                            <button class="btn-delete btn-small" onclick="deleteMatch('${matchdayId}', '${matchId}')">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </div>
                                    `;
                                }
                                
                                html += `</div>`;
                            });
                        }
                        
                        html += `</div></div>`;
                    });
                }
                
                contentArea.innerHTML = html;
            }).catch((error) => {
                contentArea.innerHTML = `
                    <div class="content-placeholder">
                        <h2>Error Loading Fixtures</h2>
                        <p>${error.message}</p>
                    </div>
                `;
            });
        }

        // Create new matchday (admin only)
        function createMatchday() {
            if (!isAdmin) return;
            const name = document.getElementById('matchdayName').value;
            const date = document.getElementById('matchdayDate').value;
            
            if (!name || !date) {
                alert('Please enter both matchday name and date');
                return;
            }
            
            const matchdayId = Date.now().toString();
            const matchday = {
                name: name,
                date: new Date(date).getTime(),
                matches: {},
                createdAt: Date.now(),
                createdBy: currentUser?.email || 'admin'
            };
            
            database.ref(`fixtures/matchdays/${matchdayId}`).set(matchday)
                .then(() => {
                    logAction(`Created matchday: ${name}`, 'Fixtures');
                    showSuccessMessage('Matchday created successfully!');
                    document.getElementById('matchdayName').value = '';
                    document.getElementById('matchdayDate').value = '';
                    loadFixturesContent();
                })
                .catch((error) => {
                    alert('Error creating matchday: ' + error.message);
                });
        }

        // Toggle matchday visibility (everyone can toggle)
        function toggleMatchday(matchdayId) {
            const matchesDiv = document.getElementById(`matches-${matchdayId}`);
            const chevron = document.getElementById(`chevron-${matchdayId}`);
            
            if (matchesDiv.style.display === 'none') {
                matchesDiv.style.display = 'block';
                chevron.classList.remove('fa-chevron-right');
                chevron.classList.add('fa-chevron-down');
            } else {
                matchesDiv.style.display = 'none';
                chevron.classList.remove('fa-chevron-down');
                chevron.classList.add('fa-chevron-right');
            }
        }

        // Add match to matchday (admin only)
        function addMatch(matchdayId) {
            if (!isAdmin) return;
            // Load teams for selection
            database.ref('registry/teams').once('value')
                .then((snapshot) => {
                    const teams = snapshot.val() || {};
                    
                    // Create modal for adding match
                    const modal = document.createElement('div');
                    modal.className = 'modal active';
                    modal.style.zIndex = '3000';
                    
                    let teamOptions = '<option value="">Select a team...</option>';
                    Object.entries(teams).forEach(([id, team]) => {
                        teamOptions += `<option value="${id}" style="color: ${team.color}">${team.name}</option>`;
                    });
                    
                    modal.innerHTML = `
                        <div class="modal-content">
                            <div class="modal-header">
                                <h2>Add New Match</h2>
                            </div>
                            
                            <div class="form-group">
                                <label>Home Team</label>
                                <select id="homeTeam">
                                    ${teamOptions}
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label>Away Team</label>
                                <select id="awayTeam">
                                    ${teamOptions}
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label>Venue</label>
                                <input type="text" id="venue" placeholder="e.g., Blue Lock Stadium">
                            </div>
                            
                            <div class="form-group">
                                <label>Time</label>
                                <input type="time" id="matchTime">
                            </div>
                            
                            <button class="btn" onclick="saveMatch('${matchdayId}')">Create Match</button>
                            <button class="btn btn-secondary" onclick="this.closest('.modal').remove()">Cancel</button>
                        </div>
                    `;
                    
                    document.body.appendChild(modal);
                })
                .catch((error) => {
                    alert('Error loading teams: ' + error.message);
                });
        }

        // Save new match (admin only)
        function saveMatch(matchdayId) {
            if (!isAdmin) return;
            const homeTeam = document.getElementById('homeTeam').value;
            const awayTeam = document.getElementById('awayTeam').value;
            const venue = document.getElementById('venue').value;
            const time = document.getElementById('matchTime').value;
            
            if (!homeTeam || !awayTeam) {
                alert('Please select both teams');
                return;
            }
            
            if (homeTeam === awayTeam) {
                alert('Home team and away team cannot be the same');
                return;
            }
            
            const matchId = Date.now().toString();
            const match = {
                homeTeam: homeTeam,
                awayTeam: awayTeam,
                venue: venue || 'TBD',
                time: time || '12:00',
                status: 'scheduled',
                createdAt: Date.now(),
                createdBy: currentUser?.email || 'admin'
            };
            
            database.ref(`fixtures/matchdays/${matchdayId}/matches/${matchId}`).set(match)
                .then(() => {
                    logAction(`Added match to matchday`, 'Fixtures');
                    // Close modal
                    document.querySelector('.modal.active').remove();
                    showSuccessMessage('Match created successfully!');
                    loadFixturesContent();
                })
                .catch((error) => {
                    alert('Error creating match: ' + error.message);
                });
        }

        // Edit match (admin only)
        function editMatch(matchdayId, matchId) {
            if (!isAdmin) return;
            // Load match data and teams
            Promise.all([
                database.ref(`fixtures/matchdays/${matchdayId}/matches/${matchId}`).once('value'),
                database.ref('registry/teams').once('value')
            ]).then(([matchSnapshot, teamsSnapshot]) => {
                const match = matchSnapshot.val();
                const teams = teamsSnapshot.val() || {};
                
                if (!match) {
                    alert('Match not found');
                    return;
                }
                
                // Create modal for editing match
                const modal = document.createElement('div');
                modal.className = 'modal active';
                modal.style.zIndex = '3000';
                
                let homeOptions = '<option value="">Select home team...</option>';
                let awayOptions = '<option value="">Select away team...</option>';
                
                Object.entries(teams).forEach(([id, team]) => {
                    const selectedHome = id === match.homeTeam ? 'selected' : '';
                    const selectedAway = id === match.awayTeam ? 'selected' : '';
                    homeOptions += `<option value="${id}" ${selectedHome} style="color: ${team.color}">${team.name}</option>`;
                    awayOptions += `<option value="${id}" ${selectedAway} style="color: ${team.color}">${team.name}</option>`;
                });
                
                modal.innerHTML = `
                    <div class="modal-content">
                        <div class="modal-header">
                            <h2>Edit Match</h2>
                        </div>
                        
                        <div class="form-group">
                            <label>Home Team</label>
                            <select id="editHomeTeam">
                                ${homeOptions}
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label>Away Team</label>
                            <select id="editAwayTeam">
                                ${awayOptions}
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label>Venue</label>
                            <input type="text" id="editVenue" value="${match.venue || ''}">
                        </div>
                        
                        <div class="form-group">
                            <label>Time</label>
                            <input type="time" id="editMatchTime" value="${match.time || '12:00'}">
                        </div>
                        
                        <button class="btn" onclick="updateMatch('${matchdayId}', '${matchId}')">Update Match</button>
                        <button class="btn btn-secondary" onclick="this.closest('.modal').remove()">Cancel</button>
                    </div>
                `;
                
                document.body.appendChild(modal);
            }).catch((error) => {
                alert('Error loading match data: ' + error.message);
            });
        }

        // Update match (admin only)
        function updateMatch(matchdayId, matchId) {
            if (!isAdmin) return;
            const homeTeam = document.getElementById('editHomeTeam').value;
            const awayTeam = document.getElementById('editAwayTeam').value;
            const venue = document.getElementById('editVenue').value;
            const time = document.getElementById('editMatchTime').value;
            
            if (!homeTeam || !awayTeam) {
                alert('Please select both teams');
                return;
            }
            
            if (homeTeam === awayTeam) {
                alert('Home team and away team cannot be the same');
                return;
            }
            
            const updates = {
                homeTeam: homeTeam,
                awayTeam: awayTeam,
                venue: venue || 'TBD',
                time: time || '12:00',
                updatedAt: Date.now()
            };
            
            database.ref(`fixtures/matchdays/${matchdayId}/matches/${matchId}`).update(updates)
                .then(() => {
                    logAction(`Updated match`, 'Fixtures');
                    // Close modal
                    document.querySelector('.modal.active').remove();
                    showSuccessMessage('Match updated successfully!');
                    loadFixturesContent();
                })
                .catch((error) => {
                    alert('Error updating match: ' + error.message);
                });
        }

        // Delete match (admin only)
        function deleteMatch(matchdayId, matchId) {
            if (!isAdmin) return;
            if (confirm('Are you sure you want to delete this match?')) {
                database.ref(`fixtures/matchdays/${matchdayId}/matches/${matchId}`).remove()
                    .then(() => {
                        logAction(`Deleted match`, 'Fixtures');
                        showSuccessMessage('Match deleted successfully!');
                        loadFixturesContent();
                    })
                    .catch((error) => {
                        alert('Error deleting match: ' + error.message);
                    });
            }
        }

        // Delete matchday (admin only)
        function deleteMatchday(matchdayId) {
            if (!isAdmin) return;
            if (confirm('Are you sure you want to delete this matchday and all its matches?')) {
                database.ref(`fixtures/matchdays/${matchdayId}`).remove()
                    .then(() => {
                        logAction(`Deleted matchday`, 'Fixtures');
                        showSuccessMessage('Matchday deleted successfully!');
                        loadFixturesContent();
                    })
                    .catch((error) => {
                        alert('Error deleting matchday: ' + error.message);
                    });
            }
        }

        // Enter results for a match (admin only)
        function enterResults(matchdayId, matchId) {
            if (!isAdmin) return;
            currentEditingMatch = { matchdayId, matchId };
            isEditingResults = false;
            
            // Load match data, teams, and players
            Promise.all([
                database.ref(`fixtures/matchdays/${matchdayId}/matches/${matchId}`).once('value'),
                database.ref('registry/teams').once('value'),
                database.ref('registry/players').once('value')
            ]).then(([matchSnapshot, teamsSnapshot, playersSnapshot]) => {
                const match = matchSnapshot.val();
                const teams = teamsSnapshot.val() || {};
                const allPlayers = playersSnapshot.val() || {};
                
                if (!match) {
                    alert('Match not found');
                    return;
                }
                
                const homeTeam = teams[match.homeTeam] || { name: 'Unknown', color: '#0a1c3a' };
                const awayTeam = teams[match.awayTeam] || { name: 'Unknown', color: '#0a1c3a' };
                
                // Get players for each team
                const homePlayers = Object.entries(allPlayers)
                    .filter(([_, player]) => player.teamId === match.homeTeam)
                    .map(([id, player]) => ({ id, ...player }));
                
                const awayPlayers = Object.entries(allPlayers)
                    .filter(([_, player]) => player.teamId === match.awayTeam)
                    .map(([id, player]) => ({ id, ...player }));
                
                const contentArea = document.getElementById('contentArea');
                
                let html = `
                    <div class="result-entry">
                        <h2 style="margin-bottom: 2rem;">Enter Results: <span style="color: ${homeTeam.color}; text-shadow: 0 0 10px ${homeTeam.color};">${homeTeam.name}</span> vs <span style="color: ${awayTeam.color}; text-shadow: 0 0 10px ${awayTeam.color};">${awayTeam.name}</span></h2>
                        
                        <!-- Fouls Section -->
                        <div class="fouls-section">
                            <div style="display: flex; align-items: center; gap: 2rem;">
                                <label style="color: ${homeTeam.color}">${homeTeam.name} Fouls:</label>
                                <input type="number" id="homeFouls" class="fouls-input" value="0" min="0">
                            </div>
                            <div style="display: flex; align-items: center; gap: 2rem;">
                                <label style="color: ${awayTeam.color}">${awayTeam.name} Fouls:</label>
                                <input type="number" id="awayFouls" class="fouls-input" value="0" min="0">
                            </div>
                        </div>
                        
                        <!-- Teams Stats -->
                        <div class="teams-container">
                            <!-- Home Team -->
                            <div class="team-stats">
                                <h3 style="color: ${homeTeam.color}; text-shadow: 0 0 10px ${homeTeam.color};">
                                    <div class="team-color" style="background-color: ${homeTeam.color}; box-shadow: 0 0 10px ${homeTeam.color};"></div>
                                    ${homeTeam.name}
                                </h3>
                                
                                <div class="player-stat-row header">
                                    <div>Player</div>
                                    <div>Legs</div>
                                    <div>Goals</div>
                                    <div>Assists</div>
                                    <div>Saves</div>
                                </div>
                `;
                
                // Add home team players
                homePlayers.forEach(player => {
                    html += `
                        <div class="player-stat-row">
                            <div class="player-name" style="color: ${homeTeam.color}" onclick="showPlayerProfile('${player.id}')">${player.name}</div>
                            <div>
                                <select class="leg-select" id="home-${player.id}-legs" onchange="toggleStatsInputs('home-${player.id}')">
                                    <option value="dnp">DNP</option>
                                    <option value="full">Full</option>
                                    <option value="first">1st Leg</option>
                                    <option value="second">2nd Leg</option>
                                </select>
                            </div>
                            <div><input type="number" class="stat-input" id="home-${player.id}-goals" value="0" min="0" disabled></div>
                            <div><input type="number" class="stat-input" id="home-${player.id}-assists" value="0" min="0" disabled></div>
                            <div><input type="number" class="stat-input" id="home-${player.id}-saves" value="0" min="0" disabled></div>
                        </div>
                    `;
                });
                
                html += `
                            </div>
                            
                            <!-- Away Team -->
                            <div class="team-stats">
                                <h3 style="color: ${awayTeam.color}; text-shadow: 0 0 10px ${awayTeam.color};">
                                    <div class="team-color" style="background-color: ${awayTeam.color}; box-shadow: 0 0 10px ${awayTeam.color};"></div>
                                    ${awayTeam.name}
                                </h3>
                                
                                <div class="player-stat-row header">
                                    <div>Player</div>
                                    <div>Legs</div>
                                    <div>Goals</div>
                                    <div>Assists</div>
                                    <div>Saves</div>
                                </div>
                `;
                
                // Add away team players
                awayPlayers.forEach(player => {
                    html += `
                        <div class="player-stat-row">
                            <div class="player-name" style="color: ${awayTeam.color}" onclick="showPlayerProfile('${player.id}')">${player.name}</div>
                            <div>
                                <select class="leg-select" id="away-${player.id}-legs" onchange="toggleStatsInputs('away-${player.id}')">
                                    <option value="dnp">DNP</option>
                                    <option value="full">Full</option>
                                    <option value="first">1st Leg</option>
                                    <option value="second">2nd Leg</option>
                                </select>
                            </div>
                            <div><input type="number" class="stat-input" id="away-${player.id}-goals" value="0" min="0" disabled></div>
                            <div><input type="number" class="stat-input" id="away-${player.id}-assists" value="0" min="0" disabled></div>
                            <div><input type="number" class="stat-input" id="away-${player.id}-saves" value="0" min="0" disabled></div>
                        </div>
                    `;
                });
                
                // MVP and MOTM Selection
                html += `
                            </div>
                        </div>
                        
                        <div class="mvp-motm-section">
                            <div class="selection-group">
                                <label>MVP (Most Valuable Player)</label>
                                <select id="mvpPlayer">
                                    <option value="">Select MVP...</option>
                `;
                
                // Add all players to MVP select
                [...homePlayers, ...awayPlayers].forEach(player => {
                    const teamColor = player.teamId === match.homeTeam ? homeTeam.color : awayTeam.color;
                    html += `<option value="${player.id}" style="color: ${teamColor}">${player.name}</option>`;
                });
                
                html += `
                                </select>
                            </div>
                            
                            <div class="selection-group">
                                <label>MOTM (Man of the Match)</label>
                                <select id="motmPlayer">
                                    <option value="">Select MOTM...</option>
                `;
                
                // Add all players to MOTM select
                [...homePlayers, ...awayPlayers].forEach(player => {
                    const teamColor = player.teamId === match.homeTeam ? homeTeam.color : awayTeam.color;
                    html += `<option value="${player.id}" style="color: ${teamColor}">${player.name}</option>`;
                });
                
                html += `
                                </select>
                            </div>
                        </div>
                        
                        <div style="display: flex; gap: 1rem; justify-content: center;">
                            <button class="btn btn-success" onclick="saveMatchResults('${matchdayId}', '${matchId}')">
                                <i class="fas fa-check"></i> Finalize Match
                            </button>
                            <button class="btn btn-secondary" onclick="loadFixturesContent()">
                                <i class="fas fa-times"></i> Cancel
                            </button>
                        </div>
                    </div>
                `;
                
                contentArea.innerHTML = html;
            }).catch((error) => {
                alert('Error loading match data: ' + error.message);
            });
        }

        // Helper function to enable/disable stat inputs based on leg selection
        window.toggleStatsInputs = function(prefix) {
            const legSelect = document.getElementById(prefix + '-legs');
            const goalsInput = document.getElementById(prefix + '-goals');
            const assistsInput = document.getElementById(prefix + '-assists');
            const savesInput = document.getElementById(prefix + '-saves');
            
            if (legSelect.value === 'dnp') {
                goalsInput.disabled = true;
                assistsInput.disabled = true;
                savesInput.disabled = true;
                // Clear values when DNP
                goalsInput.value = 0;
                assistsInput.value = 0;
                savesInput.value = 0;
            } else {
                goalsInput.disabled = false;
                assistsInput.disabled = false;
                savesInput.disabled = false;
            }
        };

        // Save match results (admin only) - now with proper revert for edits
        function saveMatchResults(matchdayId, matchId) {
            if (!isAdmin) return;
            // Get all player stats
            const playerStats = {};
            
            // Get all input elements
            const inputs = document.querySelectorAll('[id^="home-"],[id^="away-"]');
            
            inputs.forEach(input => {
                const [team, playerId, stat] = input.id.split('-');
                if (!playerStats[playerId]) {
                    playerStats[playerId] = { team, goals: 0, assists: 0, saves: 0, legs: 'dnp' };
                }
                
                if (stat === 'goals') playerStats[playerId].goals = parseInt(input.value) || 0;
                if (stat === 'assists') playerStats[playerId].assists = parseInt(input.value) || 0;
                if (stat === 'saves') playerStats[playerId].saves = parseInt(input.value) || 0;
                if (stat === 'legs') {
                    const legSelect = document.getElementById(`${team}-${playerId}-legs`);
                    playerStats[playerId].legs = legSelect ? legSelect.value : 'dnp';
                }
            });
            
            // Get fouls
            const homeFouls = parseInt(document.getElementById('homeFouls').value) || 0;
            const awayFouls = parseInt(document.getElementById('awayFouls').value) || 0;
            
            // Get MVP and MOTM
            const mvpPlayer = document.getElementById('mvpPlayer').value;
            const motmPlayer = document.getElementById('motmPlayer').value;
            
            if (!mvpPlayer || !motmPlayer) {
                alert('Please select both MVP and MOTM');
                return;
            }
            
            // Calculate total goals (including foul deductions)
            let homeTotalGoals = 0;
            let awayTotalGoals = 0;
            
            Object.entries(playerStats).forEach(([playerId, stats]) => {
                if (stats.team === 'home') {
                    homeTotalGoals += stats.goals;
                } else {
                    awayTotalGoals += stats.goals;
                }
            });
            
            // Apply foul deductions
            homeTotalGoals = Math.max(0, homeTotalGoals - homeFouls);
            awayTotalGoals = Math.max(0, awayTotalGoals - awayFouls);
            
            // Get home and away team names
            const homeTeamName = document.querySelector('.team-stats h3').textContent.trim();
            const awayTeamName = document.querySelectorAll('.team-stats h3')[1].textContent.trim();
            
            // Create result object
            const result = {
                matchdayId: matchdayId,
                matchId: matchId,
                homeTeam: homeTeamName,
                awayTeam: awayTeamName,
                homeScore: homeTotalGoals,
                awayScore: awayTotalGoals,
                homeFouls: homeFouls,
                awayFouls: awayFouls,
                mvp: mvpPlayer,
                motm: motmPlayer,
                playerStats: playerStats,
                timestamp: Date.now(),
                recordedBy: currentUser?.email || 'admin'
            };
            
            // Save result to database
            const resultId = `${matchdayId}_${matchId}`;
            
            // Check if this result already exists
            database.ref(`results/${resultId}`).once('value')
                .then((snapshot) => {
                    const existingResult = snapshot.val();
                    let operations = [];
                    
                    // If editing, we need to revert old stats first
                    if (existingResult) {
                        if (confirm('A result already exists for this match. Do you want to overwrite it?')) {
                            isEditingResults = true;
                            
                            // Build revert operations from old result
                            const revertOps = [];
                            
                            // Revert player stats
                            Object.entries(existingResult.playerStats || {}).forEach(([playerId, stats]) => {
                                const oldLegValue = stats.legs === 'full' ? 2 : (stats.legs === 'dnp' ? 0 : 1);
                                const playerRef = database.ref(`registry/players/${playerId}`);
                                
                                revertOps.push(playerRef.child('goals').set(firebase.database.ServerValue.increment(-(stats.goals || 0))));
                                revertOps.push(playerRef.child('assists').set(firebase.database.ServerValue.increment(-(stats.assists || 0))));
                                revertOps.push(playerRef.child('saves').set(firebase.database.ServerValue.increment(-(stats.saves || 0))));
                                revertOps.push(playerRef.child('legs').set(firebase.database.ServerValue.increment(-oldLegValue)));
                            });
                            
                            // Revert awards
                            if (existingResult.mvp) {
                                revertOps.push(database.ref(`registry/players/${existingResult.mvp}/awards`).set(firebase.database.ServerValue.increment(-1)));
                            }
                            if (existingResult.motm && existingResult.motm !== existingResult.mvp) {
                                revertOps.push(database.ref(`registry/players/${existingResult.motm}/awards`).set(firebase.database.ServerValue.increment(-1)));
                            }
                            
                            // Wait for revert operations to complete before applying new ones
                            return Promise.all(revertOps).then(() => {
                                // Now apply new stats
                                const applyOps = [];
                                applyOps.push(database.ref(`results/${resultId}`).set(result));
                                applyOps.push(database.ref(`fixtures/matchdays/${matchdayId}/matches/${matchId}/status`).set('completed'));
                                
                                Object.entries(playerStats).forEach(([playerId, stats]) => {
                                    const legValue = stats.legs === 'full' ? 2 : (stats.legs === 'dnp' ? 0 : 1);
                                    const playerRef = database.ref(`registry/players/${playerId}`);
                                    
                                    applyOps.push(playerRef.child('goals').set(firebase.database.ServerValue.increment(stats.goals)));
                                    applyOps.push(playerRef.child('assists').set(firebase.database.ServerValue.increment(stats.assists)));
                                    applyOps.push(playerRef.child('saves').set(firebase.database.ServerValue.increment(stats.saves)));
                                    applyOps.push(playerRef.child('legs').set(firebase.database.ServerValue.increment(legValue)));
                                    
                                    if (playerId === mvpPlayer || playerId === motmPlayer) {
                                        applyOps.push(playerRef.child('awards').set(firebase.database.ServerValue.increment(1)));
                                    }
                                });
                                
                                return Promise.all(applyOps);
                            });
                        } else {
                            return Promise.reject('Edit cancelled');
                        }
                    } else {
                        // New result, just apply
                        operations.push(database.ref(`results/${resultId}`).set(result));
                        operations.push(database.ref(`fixtures/matchdays/${matchdayId}/matches/${matchId}/status`).set('completed'));
                        
                        Object.entries(playerStats).forEach(([playerId, stats]) => {
                            const legValue = stats.legs === 'full' ? 2 : (stats.legs === 'dnp' ? 0 : 1);
                            const playerRef = database.ref(`registry/players/${playerId}`);
                            
                            operations.push(playerRef.child('goals').set(firebase.database.ServerValue.increment(stats.goals)));
                            operations.push(playerRef.child('assists').set(firebase.database.ServerValue.increment(stats.assists)));
                            operations.push(playerRef.child('saves').set(firebase.database.ServerValue.increment(stats.saves)));
                            operations.push(playerRef.child('legs').set(firebase.database.ServerValue.increment(legValue)));
                            
                            if (playerId === mvpPlayer || playerId === motmPlayer) {
                                operations.push(playerRef.child('awards').set(firebase.database.ServerValue.increment(1)));
                            }
                        });
                        
                        return Promise.all(operations);
                    }
                })
                .then(() => {
                    logAction(`Saved match results: ${homeTeamName} ${homeTotalGoals}-${awayTotalGoals} ${awayTeamName}`, 'Results');
                    showSuccessMessage('Match results saved successfully!');
                    loadFixturesContent();
                })
                .catch((error) => {
                    if (error !== 'Edit cancelled') {
                        alert('Error saving match results: ' + error.message);
                    }
                });
        }

        // Edit existing results (admin only)
        function editResults(matchdayId, matchId) {
            if (!isAdmin) return;
            isEditingResults = true;
            const resultId = `${matchdayId}_${matchId}`;
            
            database.ref(`results/${resultId}`).once('value')
                .then((snapshot) => {
                    const result = snapshot.val();
                    if (!result) {
                        alert('No results found for this match');
                        return;
                    }
                    
                    // Load the match with pre-filled data
                    enterResults(matchdayId, matchId);
                    
                    // After loading, populate with existing data
                    setTimeout(() => {
                        // Set fouls
                        document.getElementById('homeFouls').value = result.homeFouls || 0;
                        document.getElementById('awayFouls').value = result.awayFouls || 0;
                        
                        // Set MVP and MOTM
                        document.getElementById('mvpPlayer').value = result.mvp || '';
                        document.getElementById('motmPlayer').value = result.motm || '';
                        
                        // Set player stats
                        Object.entries(result.playerStats || {}).forEach(([playerId, stats]) => {
                            const team = stats.team;
                            const legSelect = document.getElementById(`${team}-${playerId}-legs`);
                            const goalsInput = document.getElementById(`${team}-${playerId}-goals`);
                            const assistsInput = document.getElementById(`${team}-${playerId}-assists`);
                            const savesInput = document.getElementById(`${team}-${playerId}-saves`);
                            
                            if (legSelect) {
                                legSelect.value = stats.legs || 'dnp';
                                // Trigger the toggle function to set disabled state and values
                                if (window.toggleStatsInputs) {
                                    window.toggleStatsInputs(`${team}-${playerId}`);
                                }
                            }
                            if (goalsInput) goalsInput.value = stats.goals || 0;
                            if (assistsInput) assistsInput.value = stats.assists || 0;
                            if (savesInput) savesInput.value = stats.saves || 0;
                        });
                    }, 500);
                })
                .catch((error) => {
                    alert('Error loading results: ' + error.message);
                });
        }

        // Load Results content (visible to everyone)
        function loadResultsContent() {
            const contentArea = document.getElementById('contentArea');
            
            // Show loading state
            contentArea.innerHTML = `
                <div class="content-placeholder">
                    <div class="spinner" style="width: 30px; height: 30px; margin: 0 auto 1rem;"></div>
                    <p>Loading results...</p>
                </div>
            `;
            
            // Load results and player data
            Promise.all([
                database.ref('results').once('value'),
                database.ref('registry/players').once('value'),
                database.ref('registry/teams').once('value')
            ]).then(([resultsSnapshot, playersSnapshot, teamsSnapshot]) => {
                const results = resultsSnapshot.val() || {};
                const players = playersSnapshot.val() || {};
                const teams = teamsSnapshot.val() || {};
                
                let html = '<h2 style="margin-bottom: 2rem;">Match Results</h2>';
                
                if (Object.keys(results).length === 0) {
                    html += `<p class="warning-text">No results recorded yet.</p>`;
                } else {
                    // Sort results by timestamp (newest first)
                    const sortedResults = Object.entries(results)
                        .sort(([, a], [, b]) => b.timestamp - a.timestamp);
                    
                    sortedResults.forEach(([resultId, result]) => {
                        // Find teams by name
                        const homeTeam = Object.values(teams).find(t => t.name === result.homeTeam) || { name: result.homeTeam, color: '#0a1c3a' };
                        const awayTeam = Object.values(teams).find(t => t.name === result.awayTeam) || { name: result.awayTeam, color: '#0a1c3a' };
                        
                        // Get MVP and MOTM names
                        const mvpPlayer = players[result.mvp] || { name: 'Unknown' };
                        const motmPlayer = players[result.motm] || { name: 'Unknown' };
                        
                        html += `
                            <div class="result-card" id="result-${resultId}">
                                <div class="result-header">
                                    <div>
                                        <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 0.5rem;">
                                            <span style="color: ${homeTeam.color}; font-weight: 600; text-shadow: 0 0 10px ${homeTeam.color};">${result.homeTeam}</span>
                                            <span class="result-score">${result.homeScore} - ${result.awayScore}</span>
                                            <span style="color: ${awayTeam.color}; font-weight: 600; text-shadow: 0 0 10px ${awayTeam.color};">${result.awayTeam}</span>
                                        </div>
                                        <div style="display: flex; gap: 1rem; font-size: 0.9rem; color: var(--text-light);">
                                            <span>Fouls: ${result.homeFouls || 0} - ${result.awayFouls || 0}</span>
                                            <span>${new Date(result.timestamp).toLocaleString()}</span>
                                        </div>
                                    </div>
                                    <div class="result-badges">
                                        <span class="badge-mvp"><i class="fas fa-star"></i> MVP: ${mvpPlayer.name}</span>
                                        <span class="badge-motm"><i class="fas fa-crown"></i> MOTM: ${motmPlayer.name}</span>
                                        <button class="expand-btn" onclick="toggleResultDetails('${resultId}')">
                                            <i class="fas fa-chevron-down"></i> View Details
                                        </button>
                                    </div>
                                </div>
                                
                                <div class="result-details" id="details-${resultId}">
                                    <div class="player-stats-grid">
                                        <div class="team-result-stats">
                                            <h4 style="color: ${homeTeam.color}; text-shadow: 0 0 10px ${homeTeam.color};">${result.homeTeam} Players</h4>
                        `;
                        
                        // Add home team player stats
                        Object.entries(result.playerStats || {})
                            .filter(([_, stats]) => stats.team === 'home')
                            .forEach(([playerId, stats]) => {
                                const player = players[playerId] || { name: 'Unknown' };
                                const legText = stats.legs === 'full' ? '2 Legs' : 
                                              (stats.legs === 'dnp' ? 'DNP' : '1 Leg');
                                html += `
                                    <div style="display: flex; justify-content: space-between; padding: 0.25rem 0; border-bottom: 1px solid var(--border-color);">
                                        <span class="result-player-name" style="color: ${homeTeam.color}" onclick="showPlayerProfile('${playerId}')">${player.name}</span>
                                        <span>G:${stats.goals} A:${stats.assists} S:${stats.saves} (${legText})</span>
                                    </div>
                                `;
                            });
                        
                        html += `
                                        </div>
                                        <div class="team-result-stats">
                                            <h4 style="color: ${awayTeam.color}; text-shadow: 0 0 10px ${awayTeam.color};">${result.awayTeam} Players</h4>
                        `;
                        
                        // Add away team player stats
                        Object.entries(result.playerStats || {})
                            .filter(([_, stats]) => stats.team === 'away')
                            .forEach(([playerId, stats]) => {
                                const player = players[playerId] || { name: 'Unknown' };
                                const legText = stats.legs === 'full' ? '2 Legs' : 
                                              (stats.legs === 'dnp' ? 'DNP' : '1 Leg');
                                html += `
                                    <div style="display: flex; justify-content: space-between; padding: 0.25rem 0; border-bottom: 1px solid var(--border-color);">
                                        <span class="result-player-name" style="color: ${awayTeam.color}" onclick="showPlayerProfile('${playerId}')">${player.name}</span>
                                        <span>G:${stats.goals} A:${stats.assists} S:${stats.saves} (${legText})</span>
                                    </div>
                                `;
                            });
                        
                        html += `
                                        </div>
                                    </div>
                                </div>
                            </div>
                        `;
                    });
                }
                
                contentArea.innerHTML = html;
            }).catch((error) => {
                contentArea.innerHTML = `
                    <div class="content-placeholder">
                        <h2>Error Loading Results</h2>
                        <p>${error.message}</p>
                    </div>
                `;
            });
        }

        // Load Team LB content (visible to everyone)
        function loadTeamLBContent() {
            const contentArea = document.getElementById('contentArea');
            
            // Show loading state
            contentArea.innerHTML = `
                <div class="content-placeholder">
                    <div class="spinner" style="width: 30px; height: 30px; margin: 0 auto 1rem;"></div>
                    <p>Calculating team standings...</p>
                </div>
            `;
            
            // Load all data needed
            Promise.all([
                database.ref('registry/teams').once('value'),
                database.ref('results').once('value')
            ]).then(([teamsSnapshot, resultsSnapshot]) => {
                const teams = teamsSnapshot.val() || {};
                const results = resultsSnapshot.val() || {};
                
                // Calculate team statistics
                const teamStats = {};
                
                // Initialize stats for each team
                Object.keys(teams).forEach(teamId => {
                    teamStats[teamId] = {
                        name: teams[teamId].name,
                        color: teams[teamId].color || '#0a1c3a',
                        played: 0,
                        won: 0,
                        drawn: 0,
                        lost: 0,
                        goalsFor: 0,
                        goalsAgainst: 0,
                        points: 0,
                        streak: []
                    };
                });
                
                // Process each result
                Object.values(results).forEach(result => {
                    // Find team IDs by name
                    const homeTeamId = Object.keys(teams).find(id => teams[id].name === result.homeTeam);
                    const awayTeamId = Object.keys(teams).find(id => teams[id].name === result.awayTeam);
                    
                    if (homeTeamId && awayTeamId) {
                        // Update matches played
                        teamStats[homeTeamId].played++;
                        teamStats[awayTeamId].played++;
                        
                        // Update goals
                        teamStats[homeTeamId].goalsFor += result.homeScore;
                        teamStats[homeTeamId].goalsAgainst += result.awayScore;
                        teamStats[awayTeamId].goalsFor += result.awayScore;
                        teamStats[awayTeamId].goalsAgainst += result.homeScore;
                        
                        // Update win/draw/loss and points
                        if (result.homeScore > result.awayScore) {
                            teamStats[homeTeamId].won++;
                            teamStats[homeTeamId].points += 3;
                            teamStats[awayTeamId].lost++;
                            teamStats[homeTeamId].streak.push('W');
                            teamStats[awayTeamId].streak.push('L');
                        } else if (result.homeScore < result.awayScore) {
                            teamStats[awayTeamId].won++;
                            teamStats[awayTeamId].points += 3;
                            teamStats[homeTeamId].lost++;
                            teamStats[awayTeamId].streak.push('W');
                            teamStats[homeTeamId].streak.push('L');
                        } else {
                            teamStats[homeTeamId].drawn++;
                            teamStats[awayTeamId].drawn++;
                            teamStats[homeTeamId].points += 1;
                            teamStats[awayTeamId].points += 1;
                            teamStats[homeTeamId].streak.push('D');
                            teamStats[awayTeamId].streak.push('D');
                        }
                    }
                });
                
                // Keep only last 5 matches for streak
                Object.keys(teamStats).forEach(teamId => {
                    teamStats[teamId].streak = teamStats[teamId].streak.slice(-5).join('');
                });
                
                // Sort teams by points, then GD, then GF
                const sortedTeams = Object.entries(teamStats)
                    .map(([id, stats]) => ({ id, ...stats }))
                    .sort((a, b) => {
                        if (b.points !== a.points) return b.points - a.points;
                        const gdA = a.goalsFor - a.goalsAgainst;
                        const gdB = b.goalsFor - b.goalsAgainst;
                        if (gdB !== gdA) return gdB - gdA;
                        return b.goalsFor - a.goalsFor;
                    });
                
                // Find best offensive and defensive teams
                let bestOffensive = { team: '', goals: 0 };
                let bestDefensive = { team: '', goalsAgainst: Infinity };
                
                sortedTeams.forEach(team => {
                    if (team.goalsFor > bestOffensive.goals) {
                        bestOffensive = { team: team.name, goals: team.goalsFor, color: team.color };
                    }
                    if (team.goalsAgainst < bestDefensive.goalsAgainst) {
                        bestDefensive = { team: team.name, goalsAgainst: team.goalsAgainst, color: team.color };
                    }
                });
                
                // Get top team
                const topTeam = sortedTeams[0] || { name: 'N/A', points: 0, color: '#0a1c3a' };
                
                let html = `
                    <div class="stats-cards">
                        <div class="stat-card rulers">
                            <h3><i class="fas fa-crown"></i> THE RULERS</h3>
                            <div class="value" style="color: ${topTeam.color}; text-shadow: 0 0 15px ${topTeam.color};">${topTeam.name}</div>
                            <div class="team">${topTeam.points} pts</div>
                        </div>
                        <div class="stat-card offensive">
                            <h3><i class="fas fa-fire"></i> BEST OFFENSIVE</h3>
                            <div class="value" style="color: ${bestOffensive.color}; text-shadow: 0 0 15px ${bestOffensive.color};">${bestOffensive.team}</div>
                            <div class="team">${bestOffensive.goals} GF</div>
                        </div>
                        <div class="stat-card defensive">
                            <h3><i class="fas fa-shield-alt"></i> BEST DEFENSIVE</h3>
                            <div class="value" style="color: ${bestDefensive.color}; text-shadow: 0 0 15px ${bestDefensive.color};">${bestDefensive.team}</div>
                            <div class="team">${bestDefensive.goalsAgainst} GA</div>
                        </div>
                    </div>
                    
                    <div class="leaderboard-container">
                        <table class="leaderboard-table">
                            <thead>
                                <tr>
                                    <th>Rank</th>
                                    <th>Team</th>
                                    <th>MP</th>
                                    <th>W</th>
                                    <th>D</th>
                                    <th>L</th>
                                    <th>GF</th>
                                    <th>GA</th>
                                    <th>GD</th>
                                    <th>Pts</th>
                                    <th>Streak</th>
                                </tr>
                            </thead>
                            <tbody>
                `;
                
                sortedTeams.forEach((team, index) => {
                    const rankClass = index === 0 ? 'rank-1' : (index === 1 ? 'rank-2' : (index === 2 ? 'rank-3' : ''));
                    const gd = team.goalsFor - team.goalsAgainst;
                    
                    html += `
                        <tr class="${rankClass}">
                            <td><strong>#${index + 1}</strong></td>
                            <td style="color: ${team.color}; font-weight: 600; text-shadow: 0 0 10px ${team.color};">${team.name}</td>
                            <td class="${team.played === 0 ? 'stat-grey' : ''}">${team.played}</td>
                            <td class="${team.won === 0 ? 'stat-grey' : 'stat-green'}">${team.won}</td>
                            <td class="${team.drawn === 0 ? 'stat-grey' : 'stat-green'}">${team.drawn}</td>
                            <td class="${team.lost === 0 ? 'stat-grey' : 'stat-red'}">${team.lost}</td>
                            <td class="${team.goalsFor === 0 ? 'stat-grey' : 'stat-green'}">${team.goalsFor}</td>
                            <td class="${team.goalsAgainst === 0 ? 'stat-grey' : 'stat-red'}">${team.goalsAgainst}</td>
                            <td class="${gd === 0 ? 'stat-grey' : (gd > 0 ? 'stat-green' : 'stat-red')}">${gd > 0 ? '+' + gd : gd}</td>
                            <td class="${team.points === 0 ? 'stat-grey' : 'stat-purple'}"><strong>${team.points}</strong></td>
                            <td>${team.streak || ''}</td>
                        </tr>
                    `;
                });
                
                html += `
                            </tbody>
                        </table>
                    </div>
                `;
                
                contentArea.innerHTML = html;
                
                // Add animations
                if (typeof anime !== 'undefined') {
                    anime({
                        targets: '.stat-card',
                        translateY: [20, 0],
                        opacity: [0, 1],
                        easing: 'easeOutQuad',
                        duration: 800,
                        delay: anime.stagger(200)
                    });
                }
            }).catch((error) => {
                contentArea.innerHTML = `
                    <div class="content-placeholder">
                        <h2>Error Loading Team Leaderboard</h2>
                        <p>${error.message}</p>
                    </div>
                `;
            });
        }

        // Load Player LB content (visible to everyone)
        function loadPlayerLBContent(category) {
            const contentArea = document.getElementById('contentArea');
            
            // Show loading state
            contentArea.innerHTML = `
                <div class="content-placeholder">
                    <div class="spinner" style="width: 30px; height: 30px; margin: 0 auto 1rem;"></div>
                    <p>Loading player statistics...</p>
                </div>
            `;
            
            // Load players and teams first
            Promise.all([
                database.ref('registry/players').once('value'),
                database.ref('registry/teams').once('value')
            ]).then(([playersSnapshot, teamsSnapshot]) => {
                const players = playersSnapshot.val() || {};
                const teams = teamsSnapshot.val() || {};
                
                let playerList = Object.entries(players).map(([id, player]) => ({
                    id,
                    ...player,
                    teamName: teams[player.teamId]?.name || 'Unknown',
                    teamColor: teams[player.teamId]?.color || '#0a1c3a'
                }));
                
                // For most-valued, we need settings
                if (category === 'most-valued') {
                    return database.ref('settings/values').once('value')
                        .then(settingsSnapshot => {
                            const settingsData = settingsSnapshot.val() || {};
                            const settings = {
                                goalValue: settingsData.goalValue || 100000,
                                assistValue: settingsData.assistValue || 100000,
                                saveValue: settingsData.saveValue || 100000
                            };
                            
                            playerList = playerList.map(player => ({
                                ...player,
                                value: (player.goals || 0) * settings.goalValue +
                                       (player.assists || 0) * settings.assistValue +
                                       (player.saves || 0) * settings.saveValue
                            }));
                            
                            return { playerList, category };
                        });
                }
                
                return Promise.resolve({ playerList, category });
            })
            .then(({ playerList, category }) => {
                // Sort based on category
                let sortedPlayers = [];
                let title = '';
                let statField = '';
                
                switch(category) {
                    case 'most-goals':
                        sortedPlayers = playerList.sort((a, b) => (b.goals || 0) - (a.goals || 0));
                        title = ' Most Goals';
                        statField = 'goals';
                        break;
                    case 'most-assists':
                        sortedPlayers = playerList.sort((a, b) => (b.assists || 0) - (a.assists || 0));
                        title = ' Most Assists';
                        statField = 'assists';
                        break;
                    case 'most-saves':
                        sortedPlayers = playerList.sort((a, b) => (b.saves || 0) - (a.saves || 0));
                        title = ' Most Saves';
                        statField = 'saves';
                        break;
                    case 'most-awards':
                        sortedPlayers = playerList.sort((a, b) => (b.awards || 0) - (a.awards || 0));
                        title = ' Most Awards (MVP+MOTM)';
                        statField = 'awards';
                        break;
                    case 'most-valued':
                        sortedPlayers = playerList.sort((a, b) => (b.value || 0) - (a.value || 0));
                        title = ' Most Valued Players';
                        statField = 'value';
                        break;
                }
                
                // Take top 20
                sortedPlayers = sortedPlayers.slice(0, 20);
                
                let html = `
                    <h2 style="margin-bottom: 2rem;">${title}</h2>
                    <div class="leaderboard-container">
                        <table class="leaderboard-table">
                            <thead>
                                <tr>
                                    <th>Rank</th>
                                    <th>Player</th>
                                    <th>Team</th>
                                    <th>${statField === 'value' ? 'Value' : statField.charAt(0).toUpperCase() + statField.slice(1)}</th>
                                    ${category === 'most-valued' ? '<th>G</th><th>A</th><th>S</th><th>Awards</th>' : ''}
                                </tr>
                            </thead>
                            <tbody>
                `;
                
                sortedPlayers.forEach((player, index) => {
                    let rankClass = '';
                    if (index === 0) rankClass = 'player-rank-1';
                    else if (index === 1) rankClass = 'player-rank-2';
                    else if (index === 2) rankClass = 'player-rank-3';
                    
                    if (category === 'most-awards') {
                        if (index === 0) rankClass = 'award-gold';
                        else if (index === 1) rankClass = 'award-silver';
                        else if (index === 2) rankClass = 'award-bronze';
                    }
                    
                    html += `
                        <tr class="${rankClass}" onclick="showPlayerProfile('${player.id}')" style="cursor: pointer;">
                            <td><strong>#${index + 1}</strong></td>
                            <td style="font-weight: 600;">${player.name}</td>
                            <td style="color: ${player.teamColor}; text-shadow: 0 0 10px ${player.teamColor};">${player.teamName}</td>
                    `;
                    
                    if (category === 'most-valued') {
                        html += `
                            <td class="stat-purple"><strong>$${formatCompactNumber(player.value)}</strong></td>
                            <td>${player.goals || 0}</td>
                            <td>${player.assists || 0}</td>
                            <td>${player.saves || 0}</td>
                            <td>${player.awards || 0}</td>
                        `;
                    } else {
                        const value = player[statField] || 0;
                        html += `<td><strong>${statField === 'value' ? '$' + formatCompactNumber(value) : value}</strong></td>`;
                    }
                    
                    html += `</tr>`;
                });
                
                html += `
                            </tbody>
                        </table>
                    </div>
                `;
                
                contentArea.innerHTML = html;
                
                // Add animations
                if (typeof anime !== 'undefined') {
                    anime({
                        targets: 'tr',
                        translateX: [-20, 0],
                        opacity: [0, 1],
                        easing: 'easeOutQuad',
                        duration: 600,
                        delay: anime.stagger(50)
                    });
                }
            })
            .catch((error) => {
                contentArea.innerHTML = `
                    <div class="content-placeholder">
                        <h2>Error Loading Player Leaderboard</h2>
                        <p>${error.message}</p>
                    </div>
                `;
            });
        }

        // Load Logs content (admin only)
        function loadLogsContent() {
            const contentArea = document.getElementById('contentArea');
            
            if (!isAdmin) {
                contentArea.innerHTML = `
                    <div class="visitor-message">
                        <i class="fas fa-lock"></i>
                        <h3>Admin Area</h3>
                        <p>This section requires admin privileges. Please login to view logs.</p>
                    </div>
                `;
                return;
            }
            
            // Show loading state
            contentArea.innerHTML = `
                <div class="content-placeholder">
                    <div class="spinner" style="width: 30px; height: 30px; margin: 0 auto 1rem;"></div>
                    <p>Loading logs...</p>
                </div>
            `;
            
            // Load logs
            database.ref('logs').orderByChild('timestamp').limitToLast(100).once('value')
                .then((snapshot) => {
                    const logs = snapshot.val() || {};
                    
                    let html = `
                        <h2 style="margin-bottom: 2rem;">Admin Action Logs</h2>
                        <div class="logs-container">
                    `;
                    
                    // Sort logs by timestamp (newest first)
                    const sortedLogs = Object.entries(logs)
                        .sort(([, a], [, b]) => b.timestamp - a.timestamp);
                    
                    if (sortedLogs.length === 0) {
                        html += `<p class="warning-text">No logs recorded yet.</p>`;
                    } else {
                        sortedLogs.forEach(([logId, log]) => {
                            const date = new Date(log.timestamp).toLocaleString();
                            const maskedEmail = maskEmail(log.user);
                            
                            html += `
                                <div class="log-entry">
                                    <div>
                                        <span class="log-admin">${maskedEmail}</span>
                                        <span class="log-action"> - ${log.action}</span>
                                        ${log.section ? `<span class="log-section"> [${log.section}]</span>` : ''}
                                    </div>
                                    <div class="log-time">${date}</div>
                                </div>
                            `;
                        });
                    }
                    
                    html += `</div>`;
                    
                    contentArea.innerHTML = html;
                })
                .catch((error) => {
                    contentArea.innerHTML = `
                        <div class="content-placeholder">
                            <h2>Error Loading Logs</h2>
                            <p>${error.message}</p>
                        </div>
                    `;
                });
        }

        // Toggle result details (everyone can use)
        function toggleResultDetails(resultId) {
            const details = document.getElementById(`details-${resultId}`);
            const btn = event.currentTarget;
            
            if (details.classList.contains('active')) {
                details.classList.remove('active');
                btn.innerHTML = '<i class="fas fa-chevron-down"></i> View Details';
            } else {
                details.classList.add('active');
                btn.innerHTML = '<i class="fas fa-chevron-up"></i> Hide Details';
            }
        }

        // Show success message
        function showSuccessMessage(message) {
            const successMsg = document.getElementById('successMessage');
            if (successMsg) {
                successMsg.innerHTML = `<i class="fas fa-check-circle"></i> ${message}`;
                successMsg.classList.add('active');
                setTimeout(() => {
                    successMsg.classList.remove('active');
                }, 3000);
            }
        }

        // Load Others content (Admin only)
        function loadOthersContent() {
            const contentArea = document.getElementById('contentArea');
            
            if (!isAdmin) {
                contentArea.innerHTML = `
                    <div class="visitor-message">
                        <i class="fas fa-lock"></i>
                        <h3>Admin Only</h3>
                        <p>This section is only visible to administrators.</p>
                    </div>
                `;
                return;
            }
            
            // Load current values from Firebase
            database.ref('settings/values').once('value')
                .then((snapshot) => {
                    const values = snapshot.val() || {
                        goalValue: 100000,
                        assistValue: 100000,
                        saveValue: 100000
                    };
                    
                    const html = `
                        <div class="success-message" id="successMessage">
                            <i class="fas fa-check-circle"></i> Settings updated successfully!
                        </div>

                        <!-- Value Settings -->
                        <div class="settings-section">
                            <h2><i class="fas fa-coins"></i> Player Value Settings</h2>
                            <p class="warning-text">Set the base value for each stat (Min: $100,000, Max: $10,000,000)</p>
                            
                            <div class="settings-grid">
                                <div class="setting-card">
                                    <h3> Goal Value</h3>
                                    <div class="value-input-group">
                                        <label>Amount per goal <span class="current-value" id="currentGoal">$${formatCompactNumber(values.goalValue)}</span></label>
                                        <input type="number" id="goalValue" min="100000" max="10000000" step="100000" value="${values.goalValue}">
                                        <div class="value-range">
                                            <span>Min: $100,000</span>
                                            <span>Max: $10,000,000</span>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="setting-card">
                                    <h3> Assist Value</h3>
                                    <div class="value-input-group">
                                        <label>Amount per assist <span class="current-value" id="currentAssist">$${formatCompactNumber(values.assistValue)}</span></label>
                                        <input type="number" id="assistValue" min="100000" max="10000000" step="100000" value="${values.assistValue}">
                                        <div class="value-range">
                                            <span>Min: $100,000</span>
                                            <span>Max: $10,000,000</span>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="setting-card">
                                    <h3> Save Value</h3>
                                    <div class="value-input-group">
                                        <label>Amount per save <span class="current-value" id="currentSave">$${formatCompactNumber(values.saveValue)}</span></label>
                                        <input type="number" id="saveValue" min="100000" max="10000000" step="100000" value="${values.saveValue}">
                                        <div class="value-range">
                                            <span>Min: $100,000</span>
                                            <span>Max: $10,000,000</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <button class="btn btn-success" onclick="saveValueSettings()">
                                <i class="fas fa-save"></i> Save Value Settings
                            </button>
                        </div>

                        <!-- Danger Zone -->
                        <div class="settings-section danger-zone">
                            <h2><i class="fas fa-exclamation-triangle"></i> Danger Zone</h2>
                            <p class="warning-text">These actions cannot be undone. Proceed with caution.</p>
                            
                            <button class="btn btn-danger" onclick="showResetConfirmation()">
                                <i class="fas fa-trash"></i> Reset League Data
                            </button>
                            
                            <div class="reset-confirmation" id="resetConfirmation">
                                <p> WARNING: This will delete ALL league data except the Guide section!</p>
                                <p>Type <strong>DELETE</strong> to confirm:</p>
                                <input type="text" id="confirmDelete" placeholder="DELETE">
                                <div style="display: flex; gap: 1rem; margin-top: 1rem;">
                                    <button class="btn btn-danger" onclick="resetLeague()">Confirm Reset</button>
                                    <button class="btn btn-secondary" onclick="hideResetConfirmation()">Cancel</button>
                                </div>
                            </div>
                        </div>
                    `;
                    
                    contentArea.innerHTML = html;
                })
                .catch((error) => {
                    contentArea.innerHTML = `
                        <div class="content-placeholder">
                            <h2>Error Loading Settings</h2>
                            <p>${error.message}</p>
                        </div>
                    `;
                });
        }

        // Save value settings (admin only)
        function saveValueSettings() {
            if (!isAdmin) return;
            const goalValue = parseInt(document.getElementById('goalValue').value);
            const assistValue = parseInt(document.getElementById('assistValue').value);
            const saveValue = parseInt(document.getElementById('saveValue').value);
            
            // Validate ranges
            if (goalValue < 100000 || goalValue > 10000000 ||
                assistValue < 100000 || assistValue > 10000000 ||
                saveValue < 100000 || saveValue > 10000000) {
                alert('Please ensure all values are between $100,000 and $10,000,000');
                return;
            }
            
            const updates = {
                goalValue: goalValue,
                assistValue: assistValue,
                saveValue: saveValue,
                updatedAt: Date.now(),
                updatedBy: currentUser?.email || 'admin'
            };
            
            database.ref('settings/values').update(updates)
                .then(() => {
                    logAction(`Updated value settings: G:$${goalValue}, A:$${assistValue}, S:$${saveValue}`, 'Settings');
                    // Show success message
                    const successMsg = document.getElementById('successMessage');
                    successMsg.classList.add('active');
                    
                    // Update current value displays
                    document.getElementById('currentGoal').textContent = '$' + formatCompactNumber(goalValue);
                    document.getElementById('currentAssist').textContent = '$' + formatCompactNumber(assistValue);
                    document.getElementById('currentSave').textContent = '$' + formatCompactNumber(saveValue);
                    
                    // Hide success message after 3 seconds
                    setTimeout(() => {
                        successMsg.classList.remove('active');
                    }, 3000);
                })
                .catch((error) => {
                    alert('Error saving settings: ' + error.message);
                });
        }

        // Show reset confirmation (admin only)
        function showResetConfirmation() {
            if (!isAdmin) return;
            document.getElementById('resetConfirmation').classList.add('active');
        }

        // Hide reset confirmation
        function hideResetConfirmation() {
            document.getElementById('resetConfirmation').classList.remove('active');
            document.getElementById('confirmDelete').value = '';
        }

        // Reset league data (preserve Guide and Logs) - admin only
        function resetLeague() {
            if (!isAdmin) return;
            const confirmText = document.getElementById('confirmDelete').value;
            
            if (confirmText !== 'DELETE') {
                alert('Please type DELETE to confirm');
                return;
            }
            
            // Show loading state
            const contentArea = document.getElementById('contentArea');
            contentArea.innerHTML = `
                <div class="content-placeholder">
                    <div class="spinner" style="width: 30px; height: 30px; margin: 0 auto 1rem;"></div>
                    <p>Resetting league data...</p>
                </div>
            `;
            
            // First, check if user is authenticated
            if (!currentUser || !isAdmin) {
                alert('You must be logged in as admin to reset league data');
                loadOthersContent();
                return;
            }
            
            // Create updates object - preserve guide and logs
            const updates = {};
            
            // Set paths to null to delete them
            updates['/registry'] = null;
            updates['/fixtures'] = null;
            updates['/results'] = null;
           
            // Perform the update
            database.ref().update(updates)
                .then(() => {
                    logAction('Reset all league data', 'Settings');
                    alert('League data has been reset successfully!');
                    loadOthersContent();
                })
                .catch((error) => {
                    console.error('Reset error:', error);
                    alert('Error resetting league: ' + error.message);
                    loadOthersContent();
                });
        }

        // Load Guide content with admin controls
        function loadGuideContent() {
            const contentArea = document.getElementById('contentArea');
            
            // Show loading state
            contentArea.innerHTML = `
                <div class="content-placeholder">
                    <div class="spinner" style="width: 30px; height: 30px; margin: 0 auto 1rem;"></div>
                    <p>Loading guide...</p>
                </div>
            `;
            
            database.ref('guide/sections').once('value')
                .then((snapshot) => {
                    const sections = snapshot.val() || {};
                    
                    let html = '';
                    
                    // Admin add section form
                    if (isAdmin) {
                        html += `
                            <div class="add-section-form active" id="addSectionForm">
                                <h3>Add New Guide Section</h3>
                                <div class="form-row">
                                    <label>Section Title</label>
                                    <input type="text" id="newSectionTitle" placeholder="e.g., Getting Started">
                                </div>
                                <div class="form-row">
                                    <label>Content</label>
                                    <textarea id="newSectionContent" rows="5" placeholder="Write your guide content here..."></textarea>
                                </div>
                                <button class="btn" onclick="addGuideSection()">Add Section</button>
                            </div>
                        `;
                    }
                    
                    // Visitor message
                    if (!isAdmin) {
                        html += `
                            <div class="visitor-message">
                                <i class="fas fa-info-circle"></i>
                                <h3>Welcome, Visitor!</h3>
                                <p>You are currently viewing the guide. Login as admin to edit content.</p>
                            </div>
                        `;
                    }
                    
                    html += '<div class="guide-sections">';
                    
                    // Convert sections object to array and sort
                    const sectionsArray = Object.entries(sections).map(([id, data]) => ({
                        id,
                        ...data
                    })).sort((a, b) => (a.order || 0) - (b.order || 0));
                    
                    if (sectionsArray.length === 0) {
                        html += `
                            <div class="content-placeholder">
                                <h3>No Guide Sections Yet</h3>
                                <p>${isAdmin ? 'Use the form above to create your first guide section.' : 'Check back later for guide content.'}</p>
                            </div>
                        `;
                    } else {
                        sectionsArray.forEach(section => {
                            html += `
                                <div class="guide-section" id="section-${section.id}">
                                    <div class="guide-section-header">
                                        <div class="guide-section-title">${section.title || 'Untitled'}</div>
                                        ${isAdmin ? `
                                            <div>
                                                <button class="btn-edit" onclick="editGuideSection('${section.id}')">
                                                    <i class="fas fa-edit"></i> Edit
                                                </button>
                                                <button class="btn-delete" onclick="deleteGuideSection('${section.id}')">
                                                    <i class="fas fa-trash"></i> Delete
                                                </button>
                                            </div>
                                        ` : ''}
                                    </div>
                                    <div class="guide-section-content">${section.content || 'No content'}</div>
                                    <div class="guide-section-meta">
                                        Last updated: ${new Date(section.updatedAt || Date.now()).toLocaleString()}
                                    </div>
                                </div>
                            `;
                        });
                    }
                    
                    html += '</div>';
                    
                    contentArea.innerHTML = html;
                })
                .catch((error) => {
                    contentArea.innerHTML = `
                        <div class="content-placeholder">
                            <h2>Error Loading Guide</h2>
                            <p>${error.message}</p>
                        </div>
                    `;
                });
        }

        // Add new guide section (admin only)
        function addGuideSection() {
            if (!isAdmin) return;
            const title = document.getElementById('newSectionTitle').value;
            const content = document.getElementById('newSectionContent').value;
            
            if (!title || !content) {
                alert('Please fill in both title and content');
                return;
            }
            
            const sectionId = Date.now().toString();
            const newSection = {
                title,
                content,
                order: Date.now(),
                updatedAt: Date.now(),
                createdBy: currentUser?.email || 'admin'
            };
            
            database.ref(`guide/sections/${sectionId}`).set(newSection)
                .then(() => {
                    logAction(`Added guide section: ${title}`, 'Guide');
                    document.getElementById('newSectionTitle').value = '';
                    document.getElementById('newSectionContent').value = '';
                    loadGuideContent();
                })
                .catch((error) => {
                    alert('Error adding section: ' + error.message);
                });
        }

        // Edit guide section (admin only)
        function editGuideSection(sectionId) {
            if (!isAdmin) return;
            const section = document.getElementById(`section-${sectionId}`);
            const title = section.querySelector('.guide-section-title').textContent;
            const content = section.querySelector('.guide-section-content').textContent;
            
            const newTitle = prompt('Edit section title:', title);
            if (newTitle === null) return;
            
            const newContent = prompt('Edit section content:', content);
            if (newContent === null) return;
            
            database.ref(`guide/sections/${sectionId}`).update({
                title: newTitle,
                content: newContent,
                updatedAt: Date.now()
            })
            .then(() => {
                logAction(`Edited guide section: ${newTitle}`, 'Guide');
                loadGuideContent();
            })
            .catch((error) => {
                alert('Error updating section: ' + error.message);
            });
        }

        // Delete guide section (admin only)
        function deleteGuideSection(sectionId) {
            if (!isAdmin) return;
            if (confirm('Are you sure you want to delete this section?')) {
                database.ref(`guide/sections/${sectionId}`).remove()
                    .then(() => {
                        logAction(`Deleted guide section`, 'Guide');
                        loadGuideContent();
                    })
                    .catch((error) => {
                        alert('Error deleting section: ' + error.message);
                    });
            }
        }

        // Load generic content
        function loadGenericContent(section) {
            const contentArea = document.getElementById('contentArea');
            
            if (!isAdmin) {
                // Visitor view - show message
                contentArea.innerHTML = `
                    <div class="visitor-message">
                        <i class="fas fa-lock"></i>
                        <h3>Admin Area</h3>
                        <p>This section requires admin privileges. Please login to view and edit content.</p>
                    </div>
                `;
                return;
            }
            
            // Admin view - show placeholder
            contentArea.innerHTML = `
                <div class="content-placeholder">
                    <h2>${section} Section</h2>
                    <p>This section is under development. Admin controls will be added here.</p>
                    <p style="margin-top: 1rem; color: var(--text-light);">Section: ${section}</p>
                </div>
            `;
        }

        // Close modal if clicked outside
        window.onclick = function(event) {
            const modal = document.getElementById('loginModal');
            if (event.target === modal) {
                modal.classList.remove('active');
            }
        }
    </script>
</body>
</html>